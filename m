Return-Path: <etnaviv-bounces@lists.freedesktop.org>
X-Original-To: lists+etnaviv@lfdr.de
Delivered-To: lists+etnaviv@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8B64D19A51
	for <lists+etnaviv@lfdr.de>; Fri, 10 May 2019 11:12:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 28A3789BF5;
	Fri, 10 May 2019 09:12:35 +0000 (UTC)
X-Original-To: etnaviv@lists.freedesktop.org
Delivered-To: etnaviv@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 14EC789A72;
 Fri, 10 May 2019 09:09:30 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id i3so831138wml.4;
 Fri, 10 May 2019 02:09:30 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=wV/dFfhYY+95XGyP+1sD+tw2eZNc2UI209gs6SDjGvE=;
 b=XGBV9Rix5rnVV18+1mqZZEg+PxkF/3Dd+vQUL1hjUyx0r2nsu9KHij/EA1UEqon2Ui
 vx6xow08oeSuyT81vWzizk6JQNbkchm/V7SxImuAxnwcj93YAUEx6Dg6R9eARTC6cYTc
 ZUiDnYCNpTOmUZQvIgoo9jtoqEv8+z0KArQCub80hcVglwWGM3lrnPkT9haZedH+Xxph
 0u9F3XSvPT76gZoB7pOgC62WFfPlSlwwOfyBrM3colyP1bZjQUxEzv+1TS5uL88MYTDF
 xxSDmiqpxGvpYb/iPeXpRcYk4XdymetpMg9BEnkv7XfHQkIh8HJoRWEJFvzc2R5imOsT
 gAkQ==
X-Gm-Message-State: APjAAAUNzWxWL34R9RdvZHknWNo/kKMdDc4hACJUytOkngcm9n2EBu9x
 IZZy88L0DRvk1c9fVWhDqDxhKf/zNJ4=
X-Google-Smtp-Source: APXvYqybOoGs35EW+JiCM2iwy6HDCKA6ZA82+NVnwL8TXa8tMyw2Mnws9uhwQ0pATadaGyLX9fSiBA==
X-Received: by 2002:a1c:9eca:: with SMTP id h193mr6426970wme.78.1557479367626; 
 Fri, 10 May 2019 02:09:27 -0700 (PDT)
Received: from localhost.localdomain (80-110-110-254.cgn.dynamic.surfer.at.
 [80.110.110.254])
 by smtp.gmail.com with ESMTPSA id l18sm1645344wrv.38.2019.05.10.02.09.26
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Fri, 10 May 2019 02:09:26 -0700 (PDT)
From: Christian Gmeiner <christian.gmeiner@gmail.com>
To: mesa-dev@lists.freedesktop.org
Subject: [RFC PATCH 08/17] eir: add nir compiler and all its infrastructure
Date: Fri, 10 May 2019 11:09:06 +0200
Message-Id: <20190510090915.2739-9-christian.gmeiner@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190510090915.2739-1-christian.gmeiner@gmail.com>
References: <20190510090915.2739-1-christian.gmeiner@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Fri, 10 May 2019 09:12:33 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=wV/dFfhYY+95XGyP+1sD+tw2eZNc2UI209gs6SDjGvE=;
 b=ewOmaNdpdzossJS4XR2ROBPa6u/UZlS8FKq+0dqPKYQASllktId4pC1HMJbNr/3ear
 XOrj20BKVkiw0tgoHp5jMUnYuPNF7pqqno/DlKi/+7GyGWeuHS+zlfJ5HDk8NQYTTGVD
 +wYAoJ+UM8LMvqDzcsqwdNe13VmI90TxrSAiZs2oVGlJCM1qM5rdmraxVn5/GGY1xmpG
 ZHkiepddaj58WfEvoR5X14lCwCkxAOS5jS/OQ4+mWhU5Y+lR9OsHBNvuU7XDn5WLC0Uz
 f8s2C2s+cuSW0vfDBm6KMRQfhIKwAV+bRv0Z+SgVYS2KMboX900dxgj4dkcICoryM1CK
 ERxA==
X-BeenThere: etnaviv@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <etnaviv.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/etnaviv>,
 <mailto:etnaviv-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/etnaviv>
List-Post: <mailto:etnaviv@lists.freedesktop.org>
List-Help: <mailto:etnaviv-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/etnaviv>,
 <mailto:etnaviv-request@lists.freedesktop.org?subject=subscribe>
Cc: Christian Gmeiner <christian.gmeiner@gmail.com>,
 etnaviv@lists.freedesktop.org, cphealy@gmail.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: etnaviv-bounces@lists.freedesktop.org
Sender: "etnaviv" <etnaviv-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogQ2hyaXN0aWFuIEdtZWluZXIgPGNocmlzdGlhbi5nbWVpbmVyQGdtYWls
LmNvbT4KLS0tCiBzcmMvZXRuYXZpdi9jb21waWxlci9laXJfY29tcGlsZXIuYyAgICAgfCAgIDYx
ICsrCiBzcmMvZXRuYXZpdi9jb21waWxlci9laXJfY29tcGlsZXIuaCAgICAgfCAgIDI5ICsKIHNy
Yy9ldG5hdml2L2NvbXBpbGVyL2Vpcl9jb21waWxlcl9uaXIuYyB8IDEwMzUgKysrKysrKysrKysr
KysrKysrKysrKysKIHNyYy9ldG5hdml2L2NvbXBpbGVyL2Vpcl9zaGFkZXIuYyAgICAgICB8ICAz
MTIgKysrKysrKwogc3JjL2V0bmF2aXYvY29tcGlsZXIvZWlyX3NoYWRlci5oICAgICAgIHwgIDIw
MyArKysrKwogc3JjL2V0bmF2aXYvY29tcGlsZXIvbWVzb24uYnVpbGQgICAgICAgIHwgICAgNCAr
CiA2IGZpbGVzIGNoYW5nZWQsIDE2NDQgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0
IHNyYy9ldG5hdml2L2NvbXBpbGVyL2Vpcl9jb21waWxlci5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
c3JjL2V0bmF2aXYvY29tcGlsZXIvZWlyX2NvbXBpbGVyX25pci5jCiBjcmVhdGUgbW9kZSAxMDA2
NDQgc3JjL2V0bmF2aXYvY29tcGlsZXIvZWlyX3NoYWRlci5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
c3JjL2V0bmF2aXYvY29tcGlsZXIvZWlyX3NoYWRlci5oCgpkaWZmIC0tZ2l0IGEvc3JjL2V0bmF2
aXYvY29tcGlsZXIvZWlyX2NvbXBpbGVyLmMgYi9zcmMvZXRuYXZpdi9jb21waWxlci9laXJfY29t
cGlsZXIuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMC4uMzg2ZGNkMGIw
YmMKLS0tIC9kZXYvbnVsbAorKysgYi9zcmMvZXRuYXZpdi9jb21waWxlci9laXJfY29tcGlsZXIu
YwpAQCAtMCwwICsxLDYxIEBACisvKgorICogQ29weXJpZ2h0IChjKSAyMDE4IEV0bmF2aXYgUHJv
amVjdAorICogQ29weXJpZ2h0IChDKSAyMDE4IFpvZGlhYyBJbmZsaWdodCBJbm5vdmF0aW9ucwor
ICoKKyAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBh
bnkgcGVyc29uIG9idGFpbmluZyBhCisgKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29j
aWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBp
biB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGlt
aXRhdGlvbgorICogdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxp
c2gsIGRpc3RyaWJ1dGUsIHN1YiBsaWNlbnNlLAorICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRo
ZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCisgKiBTb2Z0d2Fy
ZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRp
b25zOgorICoKKyAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Np
b24gbm90aWNlIChpbmNsdWRpbmcgdGhlCisgKiBuZXh0IHBhcmFncmFwaCkgc2hhbGwgYmUgaW5j
bHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucworICogb2YgdGhlIFNv
ZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VU
IFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisgKiBJTVBMSUVELCBJTkNMVURJTkcg
QlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKyAq
IEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT04tSU5GUklOR0VNRU5ULiBJ
TiBOTyBFVkVOVCBTSEFMTAorICogVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUg
TElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKKyAqIExJQUJJTElUWSwgV0hF
VEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5H
CisgKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBU
SEUgVVNFIE9SIE9USEVSCisgKiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCisgKgorICogQXV0
aG9yczoKKyAqICAgIENocmlzdGlhbiBHbWVpbmVyIDxjaHJpc3RpYW4uZ21laW5lckBnbWFpbC5j
b20+CisgKi8KKworI2luY2x1ZGUgImVpci5oIgorI2luY2x1ZGUgImVpcl9jb21waWxlci5oIgor
I2luY2x1ZGUgInV0aWwvcmFsbG9jLmgiCisjaW5jbHVkZSAidXRpbC91X2RlYnVnLmgiCisKK3N0
YXRpYyBjb25zdCBzdHJ1Y3QgZGVidWdfbmFtZWRfdmFsdWUgc2hhZGVyX2RlYnVnX29wdGlvbnNb
XSA9IHsKKyAgIHsiZGlzYXNtIiwgIEVJUl9EQkdfRElTQVNNLCAiRHVtcCBOSVIgYW5kIGV0bmF2
aXYgc2hhZGVyIGRpc2Fzc2VtYmx5In0sCisgICB7Im9wdG1zZ3MiLCBFSVJfREJHX09QVE1TR1Ms
IkVuYWJsZSBvcHRpbWl6ZXIgZGVidWcgbWVzc2FnZXMifSwKKyAgIERFQlVHX05BTUVEX1ZBTFVF
X0VORAorfTsKKworREVCVUdfR0VUX09OQ0VfRkxBR1NfT1BUSU9OKGVpcl9jb21waWxlcl9kZWJ1
ZywgIkVJUl9DT01QSUxFUl9ERUJVRyIsIHNoYWRlcl9kZWJ1Z19vcHRpb25zLCAwKQorCitlbnVt
IGVpcl9jb21waWxlcl9kZWJ1ZyBlaXJfY29tcGlsZXJfZGVidWcgPSAwOworCitzdHJ1Y3QgZWly
X2NvbXBpbGVyICoKK2Vpcl9jb21waWxlcl9jcmVhdGUodm9pZCkKK3sKKyAgIHN0cnVjdCBlaXJf
Y29tcGlsZXIgKmNvbXBpbGVyID0gcnphbGxvYyhOVUxMLCBzdHJ1Y3QgZWlyX2NvbXBpbGVyKTsK
KworICAgaWYgKCFjb21waWxlcikKKyAgICAgIHJldHVybiBOVUxMOworCisgICBlaXJfY29tcGls
ZXJfZGVidWcgPSBkZWJ1Z19nZXRfb3B0aW9uX2Vpcl9jb21waWxlcl9kZWJ1ZygpOworICAgY29t
cGlsZXItPnNldCA9IGVpcl9yYV9hbGxvY19yZWdfc2V0KGNvbXBpbGVyKTsKKworICAgcmV0dXJu
IGNvbXBpbGVyOworfQorCit2b2lkCitlaXJfY29tcGlsZXJfZnJlZShjb25zdCBzdHJ1Y3QgZWly
X2NvbXBpbGVyICpjb21waWxlcikKK3sKKyAgIHJhbGxvY19mcmVlKCh2b2lkICopY29tcGlsZXIp
OworfQpkaWZmIC0tZ2l0IGEvc3JjL2V0bmF2aXYvY29tcGlsZXIvZWlyX2NvbXBpbGVyLmggYi9z
cmMvZXRuYXZpdi9jb21waWxlci9laXJfY29tcGlsZXIuaAppbmRleCA1YzU0MTJlNDc3My4uNjQ1
ZWU2YTBkYjIgMTAwNjQ0Ci0tLSBhL3NyYy9ldG5hdml2L2NvbXBpbGVyL2Vpcl9jb21waWxlci5o
CisrKyBiL3NyYy9ldG5hdml2L2NvbXBpbGVyL2Vpcl9jb21waWxlci5oCkBAIC0yOCw3ICsyOCwy
MSBAQAogI2lmbmRlZiBIX0VJUl9DT01QSUxFUgogI2RlZmluZSBIX0VJUl9DT01QSUxFUgogCisj
aW5jbHVkZSA8c3RkaW50Lmg+CisKKyNpZmRlZiBfX2NwbHVzcGx1cworZXh0ZXJuICJDInsKKyNl
bmRpZgorCiBzdHJ1Y3QgZWlyX3JhX3JlZ19zZXQ7CitzdHJ1Y3QgZWlyX3NoYWRlcl92YXJpYW50
OworCitlbnVtIGVpcl9jb21waWxlcl9kZWJ1ZyB7CisgICBFSVJfREJHX0RJU0FTTSAgID0gKDEg
PDwgMCksCisgICBFSVJfREJHX09QVE1TR1MgID0gKDEgPDwgMSksCit9OworCitleHRlcm4gZW51
bSBlaXJfY29tcGlsZXJfZGVidWcgZWlyX2NvbXBpbGVyX2RlYnVnOwogCiAvKioKICAqIENvbXBp
bGVyIHN0YXRlIHNhdmVkIGFjcm9zcyBjb21waWxlciBpbnZvY2F0aW9ucywgZm9yIGFueSBleHBl
bnNpdmUgZ2xvYmFsCkBAIC0zNiw2ICs1MCwyMSBAQCBzdHJ1Y3QgZWlyX3JhX3JlZ19zZXQ7CiAg
Ki8KIHN0cnVjdCBlaXJfY29tcGlsZXIgewogICAgc3RydWN0IGVpcl9yYV9yZWdfc2V0ICpzZXQ7
CisgICB1aW50MzJfdCBzaGFkZXJfY291bnQ7CiB9OwogCitzdHJ1Y3QgZWlyX2NvbXBpbGVyICoK
K2Vpcl9jb21waWxlcl9jcmVhdGUodm9pZCk7CisKK3ZvaWQKK2Vpcl9jb21waWxlcl9mcmVlKGNv
bnN0IHN0cnVjdCBlaXJfY29tcGlsZXIgKmNvbXBpbGVyKTsKKworaW50CitlaXJfY29tcGlsZV9z
aGFkZXJfbmlyKHN0cnVjdCBlaXJfY29tcGlsZXIgKmNvbXBpbGVyLAorICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgZWlyX3NoYWRlcl92YXJpYW50ICp2KTsKKworI2lmZGVmIF9fY3BsdXNw
bHVzCit9CisjZW5kaWYKKwogI2VuZGlmIC8vIEhfRUlSX0NPTVBJTEVSCmRpZmYgLS1naXQgYS9z
cmMvZXRuYXZpdi9jb21waWxlci9laXJfY29tcGlsZXJfbmlyLmMgYi9zcmMvZXRuYXZpdi9jb21w
aWxlci9laXJfY29tcGlsZXJfbmlyLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAuLjg2MmYzNDM5MGUwCi0tLSAvZGV2L251bGwKKysrIGIvc3JjL2V0bmF2aXYvY29tcGls
ZXIvZWlyX2NvbXBpbGVyX25pci5jCkBAIC0wLDAgKzEsMTAzNSBAQAorLyoKKyAqIENvcHlyaWdo
dCAoYykgMjAxOCBFdG5hdml2IFByb2plY3QKKyAqIENvcHlyaWdodCAoQykgMjAxOCBab2RpYWMg
SW5mbGlnaHQgSW5ub3ZhdGlvbnMKKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVk
LCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICogY29weSBvZiB0
aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29m
dHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24s
IGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5
LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWIgbGljZW5zZSwKKyAqIGFu
ZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0
byB3aG9tIHRoZQorICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRv
IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5v
dGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVkaW5nIHRoZQorICogbmV4dCBw
YXJhZ3JhcGgpIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwg
cG9ydGlvbnMKKyAqIG9mIHRoZSBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMgUFJP
VklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgor
ICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBP
RiBNRVJDSEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBB
TkQgTk9OLUlORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBBVVRIT1JTIE9S
IENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9U
SEVSCisgKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JU
IE9SIE9USEVSV0lTRSwgQVJJU0lORworICogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04g
V0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUgorICogREVBTElOR1MgSU4gVEhF
IFNPRlRXQVJFLgorICoKKyAqIEF1dGhvcnM6CisgKiAgICBDaHJpc3RpYW4gR21laW5lciA8Y2hy
aXN0aWFuLmdtZWluZXJAZ21haWwuY29tPgorICovCisKKyNpbmNsdWRlICJjb21waWxlci9uaXIv
bmlyLmgiCisjaW5jbHVkZSAiZWlyLmgiCisjaW5jbHVkZSAiZWlyX2NvbXBpbGVyLmgiCisjaW5j
bHVkZSAiZWlyX25pci5oIgorI2luY2x1ZGUgImVpcl9zaGFkZXIuaCIKKyNpbmNsdWRlICJnYy9n
Y19pbnN0ci5oIgorI2luY2x1ZGUgInV0aWwvdV9kZWJ1Zy5oIgorI2luY2x1ZGUgInV0aWwvdV9t
YXRoLmgiCisjaW5jbHVkZSAidXRpbC91X21lbW9yeS5oIgorI2luY2x1ZGUgInV0aWwvcmFsbG9j
LmgiCisKK3N0cnVjdCBlaXJfY29udGV4dAoreworICAgc3RydWN0IGVpcl9jb21waWxlciAqY29t
cGlsZXI7CisgICBzdHJ1Y3QgbmlyX3NoYWRlciAqczsKKyAgIHN0cnVjdCBlaXIgKmlyOworICAg
c3RydWN0IGVpcl9zaGFkZXJfdmFyaWFudCAqdmFyaWFudDsKKyAgIHN0cnVjdCBlaXJfYmxvY2sg
KmJsb2NrOworICAgYm9vbCBlcnJvcjsKKworICAgdW5zaWduZWQgdW5pZm9ybXM7CisgICBzdHJ1
Y3QgZWlyX3JlZ2lzdGVyICpuaXJfbG9jYWxzOworICAgc3RydWN0IGVpcl9yZWdpc3RlciAqbmly
X3NzYV92YWx1ZXM7Cit9OworCisjZGVmaW5lIERCRyhjb21waWxlciwgZm10LCAuLi4pICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICBkbyB7ICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcCisgICAgICAgICBkZWJ1
Z19wcmludGYoIiVzOiVkOiAiIGZtdCAiXG4iLCBfX0ZVTkNUSU9OX18sIF9fTElORV9fLCBcCisg
ICAgICAgICAgICAgICAgICAgICAgIyNfX1ZBX0FSR1NfXyk7ICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBcCisgICB9IHdoaWxlICgwKQorCitzdGF0aWMgc3RydWN0IGVpcl9jb250ZXh0ICoK
K2NvbXBpbGVfaW5pdChzdHJ1Y3QgZWlyX2NvbXBpbGVyICpjb21waWxlciwKKyAgICAgICAgICAg
ICBzdHJ1Y3QgZWlyX3NoYWRlcl92YXJpYW50ICp2KQoreworICAgc3RydWN0IGVpcl9jb250ZXh0
ICpjdHggPSByemFsbG9jKE5VTEwsIHN0cnVjdCBlaXJfY29udGV4dCk7CisKKyAgIGN0eC0+Y29t
cGlsZXIgPSBjb21waWxlcjsKKworICAgbmlyX3NoYWRlciAqcyA9IG5pcl9zaGFkZXJfY2xvbmUo
Y3R4LCB2LT5zaGFkZXItPm5pcik7CisgICBjdHgtPmlyID0gZWlyX2NyZWF0ZSgpOworICAgY3R4
LT5pci0+dW5pZm9ybV9vZmZzZXQgPSBzLT5udW1fdW5pZm9ybXMgKiA0OworICAgY3R4LT5zID0g
czsKKyAgIGN0eC0+dmFyaWFudCA9IHY7CisKKyAgIC8qIHJlc2V0IHRvIHNhbmUgdmFsdWVzICov
CisgICB2LT5mc19jb2xvcl9vdXRfcmVnID0gLTE7CisgICB2LT5mc19kZXB0aF9vdXRfcmVnID0g
LTE7CisgICB2LT52c19wb2ludHNpemVfb3V0X3JlZyA9IC0xOworICAgdi0+dnNfcG9zX291dF9y
ZWcgPSAtMTsKKworICAgY3R4LT5ibG9jayA9IGVpcl9ibG9ja19jcmVhdGUoY3R4LT5pcik7CisK
KyAgIHJldHVybiBjdHg7Cit9CisKK3N0YXRpYyB2b2lkCitjb21waWxlX2ZyZWUoc3RydWN0IGVp
cl9jb250ZXh0ICpjdHgpCit7CisgICByYWxsb2NfZnJlZShjdHgpOworfQorCitzdGF0aWMgdm9p
ZAorY29tcGlsZV9lcnJvcihzdHJ1Y3QgZWlyX2NvbnRleHQgKmN0eCwgY29uc3QgY2hhciAqZm9y
bWF0LCAuLi4pCit7CisgICB2YV9saXN0IGFwOworCisgICB2YV9zdGFydChhcCwgZm9ybWF0KTsK
KyAgIF9kZWJ1Z192cHJpbnRmKGZvcm1hdCwgYXApOworICAgdmFfZW5kKGFwKTsKKworICAgbmly
X3ByaW50X3NoYWRlcihjdHgtPnMsIHN0ZG91dCk7CisKKyAgIGN0eC0+ZXJyb3IgPSB0cnVlOwor
ICAgZGVidWdfYXNzZXJ0KDApOworfQorCisjZGVmaW5lIGNvbXBpbGVfYXNzZXJ0KGN0eCwgY29u
ZCkgZG8geyBcCisgICAgICBpZiAoIShjb25kKSkgY29tcGlsZV9lcnJvcigoY3R4KSwgImZhaWxl
ZCBhc3NlcnQ6ICIjY29uZCJcbiIpOyBcCisgICB9IHdoaWxlICgwKQorCitzdGF0aWMgc3RydWN0
IGVpcl9yZWdpc3RlcgorZ2V0X25pcl9kZXN0KHN0cnVjdCBlaXJfY29udGV4dCAqY3R4LCBjb25z
dCBuaXJfZGVzdCAqZGVzdCkKK3sKKyAgIGlmIChkZXN0LT5pc19zc2EpIHsKKyAgICAgIHN0cnVj
dCBlaXJfcmVnaXN0ZXIgZHN0ID0gZWlyX3RlbXBfcmVnaXN0ZXIoY3R4LT5pciwgZGVzdC0+c3Nh
Lm51bV9jb21wb25lbnRzKTsKKworICAgICAgY3R4LT5uaXJfc3NhX3ZhbHVlc1tkZXN0LT5zc2Eu
aW5kZXhdID0gZHN0OworICAgICAgcmV0dXJuIGRzdDsKKyAgIH0gZWxzZSB7CisgICAgICByZXR1
cm4gY3R4LT5uaXJfbG9jYWxzW2Rlc3QtPnJlZy5yZWctPmluZGV4XTsKKyAgIH0KK30KKworLyoq
CisgKiBDb25zdHJ1Y3QgYW4gaWRlbnRpdHkgc3dpenpsZSBmb3IgdGhlIHNldCBvZiBlbmFibGVk
IGNoYW5uZWxzIGdpdmVuIGJ5IFxwCisgKiBtYXNrLiBUaGUgcmVzdWx0IHdpbGwgb25seSByZWZl
cmVuY2UgY2hhbm5lbHMgZW5hYmxlZCBpbiB0aGUgcHJvdmlkZWQgXHAKKyAqIG1hc2ssIGFzc3Vt
aW5nIHRoYXQgXHAgbWFzayBpcyBub24temVyby4KKyAqLworc3RhdGljIGlubGluZSB1bnNpZ25l
ZAorZWlyX3N3aXp6bGVfZm9yX21hc2sodW5zaWduZWQgbWFzaykKK3sKKyAgIHVuc2lnbmVkIGxh
c3QgPSAobWFzayA/IGZmcyhtYXNrKSAtIDEgOiAwKTsKKyAgIHVuc2lnbmVkIHN3els0XTsKKwor
ICAgZm9yICh1bnNpZ25lZCBpID0gMDsgaSA8IDQ7IGkrKykKKyAgICAgIGxhc3QgPSBzd3pbaV0g
PSAobWFzayAmICgxIDw8IGkpID8gaSA6IGxhc3QpOworCisgICByZXR1cm4gSU5TVF9TV0laKHN3
elswXSwgc3d6WzFdLCBzd3pbMl0sIHN3elszXSk7Cit9CisKKy8qKgorICogQ29uc3RydWN0IGFu
IGlkZW50aXR5IHN3aXp6bGUgZm9yIHRoZSBmaXJzdCBccCBuIGNvbXBvbmVudHMgb2YgYSB2ZWN0
b3IuCisgKi8KK3N0YXRpYyBpbmxpbmUgdW5zaWduZWQKK2Vpcl9zd2l6emxlX2Zvcl9zaXplKHVu
c2lnbmVkIG4pCit7CisgICByZXR1cm4gZWlyX3N3aXp6bGVfZm9yX21hc2soKDEgPDwgbikgLSAx
KTsKK30KKworc3RhdGljIHN0cnVjdCBlaXJfcmVnaXN0ZXIKK2dldF9uaXJfc3JjKGNvbnN0IHN0
cnVjdCBlaXJfY29udGV4dCAqY3R4LCBjb25zdCBuaXJfc3JjICpzcmMsCisgICAgICAgICAgICB1
bnNpZ25lZCBudW1fY29tcG9uZW50cykKK3sKKyAgIG5pcl9jb25zdF92YWx1ZSAqY29uc3RfdmFs
dWUgPSBuaXJfc3JjX2FzX2NvbnN0X3ZhbHVlKCpzcmMpOworICAgc3RydWN0IGVpcl9yZWdpc3Rl
ciByZWc7CisKKyAgIGlmIChjb25zdF92YWx1ZSkgeworICAgICAgYXNzZXJ0KHNyYy0+aXNfc3Nh
KTsKKyAgICAgIHVpbnQzMl90IGNbc3JjLT5zc2EtPm51bV9jb21wb25lbnRzXTsKKworICAgICAg
bmlyX2NvbnN0X3ZhbHVlX3RvX2FycmF5KGMsIGNvbnN0X3ZhbHVlLCBzcmMtPnNzYS0+bnVtX2Nv
bXBvbmVudHMsIHUzMik7CisKKyAgICAgIHJldHVybiBlaXJfdW5pZm9ybV9yZWdpc3Rlcl92ZWM0
X3VpKGN0eC0+aXIsIHNyYy0+c3NhLT5udW1fY29tcG9uZW50cywgYyk7CisgICB9CisKKyAgIGlm
IChzcmMtPmlzX3NzYSkKKyAgICAgIHJlZyA9IGN0eC0+bmlyX3NzYV92YWx1ZXNbc3JjLT5zc2Et
PmluZGV4XTsKKyAgIGVsc2UKKyAgICAgIHJlZyA9IGN0eC0+bmlyX2xvY2Fsc1tzcmMtPnJlZy5y
ZWctPmluZGV4XTsKKworICAgcmVnLnN3aXp6bGUgPSBlaXJfc3dpenpsZV9mb3Jfc2l6ZShudW1f
Y29tcG9uZW50cyk7CisKKyAgIHJldHVybiByZWc7Cit9CisKK3N0YXRpYyBpbmxpbmUgdW5zaWdu
ZWQKK2Vpcl93cml0ZW1hc2tfZm9yX3NpemUodW5zaWduZWQgbikKK3sKKyAgIHJldHVybiAoMSA8
PCBuKSAtIDE7Cit9CisKK3N0YXRpYyBpbmxpbmUgdW5zaWduZWQKK2Vpcl9zd2l6emxlX2Zvcl9u
aXJfc3dpenpsZShjb25zdCB1aW50OF90IHN3aXp6bGVbNF0pCit7CisgICByZXR1cm4gSU5TVF9T
V0laKHN3aXp6bGVbMF0sIHN3aXp6bGVbMV0sIHN3aXp6bGVbMl0sIHN3aXp6bGVbM10pOworfQor
CitzdGF0aWMgaW5saW5lIHZvaWQKK25pcl9hbHVfc3JjX3RvX2Vpcihjb25zdCBzdHJ1Y3QgZWly
X2NvbnRleHQgKmN0eCwgY29uc3QgbmlyX2FsdV9zcmMgKnNyYywgc3RydWN0IGVpcl9yZWdpc3Rl
ciAqcmVnKQoreworICAgKnJlZyA9IGdldF9uaXJfc3JjKGN0eCwgJnNyYy0+c3JjLCA0KTsKKyAg
IHJlZy0+c3dpenpsZSA9IGVpcl9zd2l6emxlX2Zvcl9uaXJfc3dpenpsZShzcmMtPnN3aXp6bGUp
OworICAgcmVnLT5hYnMgPSBzcmMtPmFiczsKKyAgIHJlZy0+bmVnID0gc3JjLT5uZWdhdGU7Cit9
CisKK3N0YXRpYyB2b2lkCitlbWl0X2FsdShzdHJ1Y3QgZWlyX2NvbnRleHQgKmN0eCwgbmlyX2Fs
dV9pbnN0ciAqYWx1KQoreworICAgY29uc3QgbmlyX29wX2luZm8gKmluZm8gPSAmbmlyX29wX2lu
Zm9zW2FsdS0+b3BdOworCisgICBzdHJ1Y3QgZWlyX2luc3RydWN0aW9uICppbnN0ciA9IE5VTEw7
CisgICBzdHJ1Y3QgZWlyX3JlZ2lzdGVyIHNyY1szXSA9IHsgfTsKKworICAgc3RydWN0IGVpcl9y
ZWdpc3RlciBkc3Q7CisgICBkc3QgPSBnZXRfbmlyX2Rlc3QoY3R4LCAmYWx1LT5kZXN0LmRlc3Qp
OworICAgZHN0LndyaXRlbWFzayA9IGFsdS0+ZGVzdC53cml0ZV9tYXNrOworCisgICBmb3IgKHVu
c2lnbmVkIGkgPSAwOyBpIDwgaW5mby0+bnVtX2lucHV0czsgaSsrKQorICAgICAgbmlyX2FsdV9z
cmNfdG9fZWlyKGN0eCwgJmFsdS0+c3JjW2ldLCAmc3JjW2ldKTsKKworICAgc3dpdGNoIChhbHUt
Pm9wKSB7CisgICBjYXNlIG5pcl9vcF9mMmkzMjoKKyAgICAgIC8qIG5vdGhpbmcgdG8gZG8gLSBm
aXJzdCBzZWVuIHdoZW4gVEdTSSB1c2VzIEFSTCBvcGMgKi8KKyAgICAgIGJyZWFrOworCisgICBj
YXNlIG5pcl9vcF9mbW92OgorICAgICAgaW5zdHIgPSBlaXJfTU9WKGN0eC0+YmxvY2ssICZkc3Qs
ICZzcmNbMF0pOworICAgICAgYnJlYWs7CisKKyAgIGNhc2UgbmlyX29wX2ZhZGQ6CisgICAgICBp
bnN0ciA9IGVpcl9BREQoY3R4LT5ibG9jaywgJmRzdCwgJnNyY1swXSwgJnNyY1sxXSk7CisgICAg
ICBicmVhazsKKworICAgY2FzZSBuaXJfb3BfZmNlaWw6CisgICAgICBpbnN0ciA9IGVpcl9DRUlM
KGN0eC0+YmxvY2ssICZkc3QsICZzcmNbMF0pOworICAgICAgYnJlYWs7CisKKyAgIGNhc2Ugbmly
X29wX2ZkZHg6CisgICAgICBpbnN0ciA9IGVpcl9EU1goY3R4LT5ibG9jaywgJmRzdCwgJnNyY1sw
XSk7CisgICAgICBicmVhazsKKworICAgY2FzZSBuaXJfb3BfZmRkeToKKyAgICAgIGluc3RyID0g
ZWlyX0RTWShjdHgtPmJsb2NrLCAmZHN0LCAmc3JjWzBdKTsKKyAgICAgIGJyZWFrOworCisgICBj
YXNlIG5pcl9vcF9mZG90MjoKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBuaXJf
b3BfZmRvdDM6CisgICAgICAvKiBmYWxsLXRocm91Z2ggKi8KKyAgIGNhc2UgbmlyX29wX2Zkb3Q0
OgorICAgICAgdW5yZWFjaGFibGUoIlNob3VsZCBiZSBsb3dlcmVkIGJ5IGZkb3RfcmVwbGljYXRl
cyA9IHRydWUiKTsKKyAgICAgIGJyZWFrOworCisgICBjYXNlIG5pcl9vcF9mZG90X3JlcGxpY2F0
ZWQyOgorICAgICAgaW5zdHIgPSBlaXJfRFAyKGN0eC0+YmxvY2ssICZkc3QsICZzcmNbMF0sICZz
cmNbMV0pOworICAgICAgYnJlYWs7CisKKyAgIGNhc2UgbmlyX29wX2Zkb3RfcmVwbGljYXRlZDM6
CisgICAgICBpbnN0ciA9IGVpcl9EUDMoY3R4LT5ibG9jaywgJmRzdCwgJnNyY1swXSwgJnNyY1sx
XSk7CisgICAgICBicmVhazsKKworICAgY2FzZSBuaXJfb3BfZmRvdF9yZXBsaWNhdGVkNDoKKyAg
ICAgIGluc3RyID0gZWlyX0RQNChjdHgtPmJsb2NrLCAmZHN0LCAmc3JjWzBdLCAmc3JjWzFdKTsK
KyAgICAgIGJyZWFrOworCisgICBjYXNlIG5pcl9vcF9mZXhwMjoKKyAgICAgIGluc3RyID0gZWly
X0VYUChjdHgtPmJsb2NrLCAmZHN0LCAmc3JjWzBdKTsKKyAgICAgIGJyZWFrOworCisgICBjYXNl
IG5pcl9vcF9mZmxvb3I6CisgICAgICBpbnN0ciA9IGVpcl9GTE9PUihjdHgtPmJsb2NrLCAmZHN0
LCAmc3JjWzBdKTsKKyAgICAgIGJyZWFrOworCisgICBjYXNlIG5pcl9vcF9mZm1hOgorICAgICAg
aW5zdHIgPSBlaXJfTUFEKGN0eC0+YmxvY2ssICZkc3QsICZzcmNbMF0sICZzcmNbMV0sICZzcmNb
Ml0pOworICAgICAgYnJlYWs7CisKKyAgIGNhc2UgbmlyX29wX2ZmcmFjdDoKKyAgICAgIGluc3Ry
ID0gZWlyX0ZSQyhjdHgtPmJsb2NrLCAmZHN0LCAmc3JjWzBdKTsKKyAgICAgIGJyZWFrOworCisg
ICBjYXNlIG5pcl9vcF9mbG9nMjoKKyAgICAgIC8qIFRPRE86IG5ldyB2cy4gb2xkIGh3ICovCisg
ICAgICBpbnN0ciA9IGVpcl9MT0coY3R4LT5ibG9jaywgJmRzdCwgJnNyY1swXSk7CisgICAgICBi
cmVhazsKKworICAgY2FzZSBuaXJfb3BfZmxycDoKKyAgICAgIHVucmVhY2hhYmxlKCJub3QgcmVh
Y2hlZDogc2hvdWxkIGJlIGxvd2VyZWQgYnkgbG93ZXJfZmxycDMyID0gdHJ1ZSIpOworICAgICAg
YnJlYWs7CisKKyAgIGNhc2UgbmlyX29wX2ZtYXg6CisgICAgICBpbnN0ciA9IGVpcl9TRUxFQ1Qo
Y3R4LT5ibG9jaywgJmRzdCwgJnNyY1swXSwgJnNyY1sxXSwgJnNyY1swXSk7CisgICAgICBpbnN0
ci0+Z2MuY29uZGl0aW9uID0gR0NfQ09ORF9MVDsKKyAgICAgIGJyZWFrOworCisgICBjYXNlIG5p
cl9vcF9mbWluOgorICAgICAgaW5zdHIgPSBlaXJfU0VMRUNUKGN0eC0+YmxvY2ssICZkc3QsICZz
cmNbMF0sICZzcmNbMV0sICZzcmNbMl0pOworICAgICAgaW5zdHItPmdjLmNvbmRpdGlvbiA9IEdD
X0NPTkRfR1Q7CisgICAgICBicmVhazsKKworICAgY2FzZSBuaXJfb3BfZm11bDoKKyAgICAgIGlu
c3RyID0gZWlyX01VTChjdHgtPmJsb2NrLCAmZHN0LCAmc3JjWzBdLCAmc3JjWzFdKTsKKyAgICAg
IGJyZWFrOworCisgICBjYXNlIG5pcl9vcF9mYWJzOgorICAgICAgLyogZmFsbC10aHJvdWdoICov
CisgICBjYXNlIG5pcl9vcF9mbmVnOgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNl
IG5pcl9vcF9mc2F0OgorICAgICAgdW5yZWFjaGFibGUoIm5vdCByZWFjaGVkOiBzaG91bGQgYmUg
bG93ZXJlZCBieSBsb3dlcl9zb3VyY2UgbW9kcyIpOworICAgICAgYnJlYWs7CisKKyAgIGNhc2Ug
bmlyX29wX2Zwb3c6CisgICAgICB1bnJlYWNoYWJsZSgibm90IHJlYWNoZWQ6IHNob3VsZCBiZSBs
b3dlcmVkIGJ5IGxvd2VyX2Zwb3cgPSB0cnVlIik7CisgICAgICBicmVhazsKKworICAgY2FzZSBu
aXJfb3BfZnJjcDoKKyAgICAgIGluc3RyID0gZWlyX1JDUChjdHgtPmJsb2NrLCAmZHN0LCAmc3Jj
WzBdKTsKKyAgICAgIGJyZWFrOworCisgICBjYXNlIG5pcl9vcF9mcnNxOgorICAgICAgaW5zdHIg
PSBlaXJfUlNRKGN0eC0+YmxvY2ssICZkc3QsICZzcmNbMF0pOworICAgICAgYnJlYWs7CisKKyAg
IGNhc2UgbmlyX29wX2Zjc2VsOgorICAgICAgaW5zdHIgPSBlaXJfU0VMRUNUKGN0eC0+YmxvY2ss
ICZkc3QsICZzcmNbMF0sICZzcmNbMV0sICZzcmNbMl0pOworICAgICAgaW5zdHItPmdjLmNvbmRp
dGlvbiA9IEdDX0NPTkRfTlo7CisgICAgICBicmVhazsKKworICAgY2FzZSBuaXJfb3BfZmNvczoK
KyAgIGNhc2UgbmlyX29wX2ZzaW46IHsKKyAgICAgIHN0cnVjdCBlaXJfcmVnaXN0ZXIgdG1wID0g
ZWlyX3RlbXBfcmVnaXN0ZXIoY3R4LT5pciwgNCk7CisgICAgICBzdHJ1Y3QgZWlyX3JlZ2lzdGVy
IG1fMl9waSA9IGVpcl91bmlmb3JtX3JlZ2lzdGVyX2YoY3R4LT5pciwgTV8yX1BJKTsKKworICAg
ICAgZWlyX01VTChjdHgtPmJsb2NrLCAmdG1wLCAmc3JjWzBdLCAmbV8yX3BpKTsKKworICAgICAg
aWYgKGFsdS0+b3AgPT0gbmlyX29wX2ZzaW4pCisgICAgICAgICBpbnN0ciA9IGVpcl9TSU4oY3R4
LT5ibG9jaywgJmRzdCwgJnRtcCk7CisgICAgICBlbHNlCisgICAgICAgICBpbnN0ciA9IGVpcl9D
T1MoY3R4LT5ibG9jaywgJmRzdCwgJnRtcCk7CisgICAgICB9CisgICAgICBicmVhazsKKworICAg
Y2FzZSBuaXJfb3BfZnNxcnQ6CisgICAgICBpbnN0ciA9IGVpcl9TUVJUKGN0eC0+YmxvY2ssICZk
c3QsICZzcmNbMF0pOworICAgICAgYnJlYWs7CisKKyAgIGNhc2UgbmlyX29wX2Z0cnVuYzoKKyAg
ICAgIHVucmVhY2hhYmxlKCJub3QgcmVhY2hlZDogc2hvdWxkIGJlIGxvd2VyZWQgYnkgbG93ZXJf
ZnRydW5jID0gdHJ1ZSIpOworICAgICAgYnJlYWs7CisKKyAgIGNhc2UgbmlyX29wX2kyZjMyOgor
ICAgY2FzZSBuaXJfb3BfdTJmMzI6CisgICAgICBpbnN0ciA9IGVpcl9NT1YoY3R4LT5ibG9jaywg
JmRzdCwgJnNyY1swXSk7CisgICAgICBicmVhazsKKworICAgY2FzZSBuaXJfb3Bfc2VxOgorICAg
ICAgaW5zdHIgPSBlaXJfU0VUKGN0eC0+YmxvY2ssICZkc3QsICZzcmNbMF0sIEdDX0NPTkRfRVEs
ICZzcmNbMV0pOworICAgICAgYnJlYWs7CisKKyAgIGNhc2UgbmlyX29wX3NnZToKKyAgICAgIGlu
c3RyID0gZWlyX1NFVChjdHgtPmJsb2NrLCAmZHN0LCAmc3JjWzBdLCBHQ19DT05EX0dFLCAmc3Jj
WzFdKTsKKyAgICAgIGJyZWFrOworCisgICBjYXNlIG5pcl9vcF9zbHQ6CisgICAgICBpbnN0ciA9
IGVpcl9TRVQoY3R4LT5ibG9jaywgJmRzdCwgJnNyY1swXSwgR0NfQ09ORF9MVCwgJnNyY1sxXSk7
CisgICAgICBicmVhazsKKworICAgY2FzZSBuaXJfb3Bfc25lOgorICAgICAgaW5zdHIgPSBlaXJf
U0VUKGN0eC0+YmxvY2ssICZkc3QsICZzcmNbMF0sIEdDX0NPTkRfTkUsICZzcmNbMV0pOworICAg
ICAgYnJlYWs7CisKKyAgIGNhc2UgbmlyX29wX2IyZjMyOgorICAgICAgLyogZmFsbC10aHJvdWdo
ICovCisgICBjYXNlIG5pcl9vcF9iMmkzMjoKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAg
Y2FzZSBuaXJfb3BfZjJiMToKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBuaXJf
b3BfaTJiMToKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBuaXJfb3BfZmx0Ogor
ICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5pcl9vcF9mZ2U6CisgICAgICAvKiBm
YWxsLXRocm91Z2ggKi8KKyAgIGNhc2UgbmlyX29wX2ZlcToKKyAgICAgIC8qIGZhbGwtdGhyb3Vn
aCAqLworICAgY2FzZSBuaXJfb3BfZm5lOgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBj
YXNlIG5pcl9vcF9pbHQ6CisgICAgICAvKiBmYWxsLXRocm91Z2ggKi8KKyAgIGNhc2UgbmlyX29w
X2lnZToKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBuaXJfb3BfaWVxOgorICAg
ICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5pcl9vcF9pbmU6CisgICAgICAvKiBmYWxs
LXRocm91Z2ggKi8KKyAgIGNhc2UgbmlyX29wX3VsdDoKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAq
LworICAgY2FzZSBuaXJfb3BfdWdlOgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNl
IG5pcl9vcF9iYWxsX2ZlcXVhbDI6CisgICAgICAvKiBmYWxsLXRocm91Z2ggKi8KKyAgIGNhc2Ug
bmlyX29wX2JhbGxfZmVxdWFsMzoKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBu
aXJfb3BfYmFsbF9mZXF1YWw0OgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5p
cl9vcF9iYW55X2ZuZXF1YWwyOgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5p
cl9vcF9iYW55X2ZuZXF1YWwzOgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5p
cl9vcF9iYW55X2ZuZXF1YWw0OgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5p
cl9vcF9iYWxsX2llcXVhbDI6CisgICAgICAvKiBmYWxsLXRocm91Z2ggKi8KKyAgIGNhc2Ugbmly
X29wX2JhbGxfaWVxdWFsMzoKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBuaXJf
b3BfYmFsbF9pZXF1YWw0OgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5pcl9v
cF9iYW55X2luZXF1YWwyOgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5pcl9v
cF9iYW55X2luZXF1YWwzOgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5pcl9v
cF9iYW55X2luZXF1YWw0OgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisgICBjYXNlIG5pcl9v
cF9iY3NlbDoKKyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBuaXJfb3BfaW1vdjoK
KyAgICAgIC8qIGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBuaXJfb3BfaWFuZDoKKyAgICAgIC8q
IGZhbGwtdGhyb3VnaCAqLworICAgY2FzZSBuaXJfb3BfaXhvcjoKKyAgICAgIC8qIGZhbGwtdGhy
b3VnaCAqLworICAgY2FzZSBuaXJfb3BfaW9yOgorICAgICAgLyogZmFsbC10aHJvdWdoICovCisg
ICBjYXNlIG5pcl9vcF9pbm90OgorICAgICAgdW5yZWFjaGFibGUoIm5vdCByZWFjaGVkOiBzaG91
bGQgYmUgbG93ZXJlZCBieSBuaXJfbG93ZXJfYm9vbF90b19mbG9hdCIpOworICAgICAgYnJlYWs7
CisKKyAgIGRlZmF1bHQ6CisgICAgICBjb21waWxlX2Vycm9yKGN0eCwgIlVuaGFuZGxlZCBBTFUg
b3A6ICVzXG4iLCBpbmZvLT5uYW1lKTsKKyAgICAgIGJyZWFrOworICAgfQorCisgICBpZiAoaW5z
dHIpCisgICAgICBpbnN0ci0+Z2Muc2F0dXJhdGUgPSBhbHUtPmRlc3Quc2F0dXJhdGU7Cit9CisK
K3N0YXRpYyB2b2lkCitlbWl0X2ludHJpbnNpYyhzdHJ1Y3QgZWlyX2NvbnRleHQgKmN0eCwgbmly
X2ludHJpbnNpY19pbnN0ciAqaW5zdHIpCit7CisgICBjb25zdCBuaXJfaW50cmluc2ljX2luZm8g
KmluZm8gPSAmbmlyX2ludHJpbnNpY19pbmZvc1tpbnN0ci0+aW50cmluc2ljXTsKKworICAgc3dp
dGNoIChpbnN0ci0+aW50cmluc2ljKSB7CisgICBjYXNlIG5pcl9pbnRyaW5zaWNfZGlzY2FyZDoK
KyAgICAgIGVpcl9URVhLSUxMKGN0eC0+YmxvY2spOworICAgICAgYnJlYWs7CisKKyAgIGNhc2Ug
bmlyX2ludHJpbnNpY19sb2FkX2lucHV0OiB7CisgICAgICBuaXJfY29uc3RfdmFsdWUgKmNvbnN0
X29mZnNldCA9IG5pcl9zcmNfYXNfY29uc3RfdmFsdWUoaW5zdHItPnNyY1swXSk7CisgICAgICBh
c3NlcnQoY29uc3Rfb2Zmc2V0KTsKKworICAgICAgc3RydWN0IGVpcl9yZWdpc3RlciBzcmMgPSB7
CisgICAgICAgICAuaW5kZXggPSBpbnN0ci0+Y29uc3RfaW5kZXhbMF0gKyBjb25zdF9vZmZzZXQt
PnUzMiwKKyAgICAgICAgIC50eXBlID0gRUlSX1JFR19URU1QLAorICAgICAgfTsKKworICAgICAg
Y3R4LT5uaXJfc3NhX3ZhbHVlc1tpbnN0ci0+ZGVzdC5zc2EuaW5kZXhdID0gc3JjOworICAgICAg
YnJlYWs7CisgICB9CisKKyAgIGNhc2UgbmlyX2ludHJpbnNpY19sb2FkX3VuaWZvcm06IHsKKyAg
ICAgIGlmIChuaXJfc3JjX2lzX2NvbnN0KGluc3RyLT5zcmNbMF0pKSB7CisgICAgICAgICBjb25z
dCB1bnNpZ25lZCBsb2FkX29mZnNldCA9IG5pcl9zcmNfYXNfdWludChpbnN0ci0+c3JjWzBdKTsK
KworICAgICAgICAgLyogT2Zmc2V0cyBhcmUgaW4gYnl0ZXMgYnV0IHRoZXkgc2hvdWxkIGFsd2F5
cyBiZSBtdWx0aXBsZXMgb2YgNCAqLworICAgICAgICAgYXNzZXJ0KGxvYWRfb2Zmc2V0ICUgNCA9
PSAwKTsKKworICAgICAgICAgc3RydWN0IGVpcl9yZWdpc3RlciBzcmMgPSB7CisgICAgICAgICAg
ICAuaW5kZXggPSBpbnN0ci0+Y29uc3RfaW5kZXhbMF0sCisgICAgICAgICAgICAudHlwZSA9IEVJ
Ul9SRUdfVU5JRk9STSwKKyAgICAgICAgIH07CisKKyAgICAgICAgIGN0eC0+bmlyX3NzYV92YWx1
ZXNbaW5zdHItPmRlc3Quc3NhLmluZGV4XSA9IHNyYzsKKyAgICAgIH0gZWxzZSB7CisgICAgICAg
ICBjb21waWxlX2Vycm9yKGN0eCwgImluZGlyZWN0IGxvYWRfdW5pZm9ybSBub3Qgc3VwcG9ydGVk
IHlldFxuIik7CisgICAgICB9CisKKyAgICAgIGJyZWFrOworICAgfQorCisgICBjYXNlIG5pcl9p
bnRyaW5zaWNfc3RvcmVfb3V0cHV0OiB7CisgICAgICAvKiBubyBzdXBwb3J0IGZvciBpbmRpcmVj
dCBvdXRwdXRzICovCisgICAgICBuaXJfY29uc3RfdmFsdWUgKmNvbnN0X29mZnNldCA9IG5pcl9z
cmNfYXNfY29uc3RfdmFsdWUoaW5zdHItPnNyY1sxXSk7CisgICAgICBhc3NlcnQoY29uc3Rfb2Zm
c2V0KTsKKworICAgICAgY29uc3QgaW50IGlkeCA9IG5pcl9pbnRyaW5zaWNfYmFzZShpbnN0cik7
CisgICAgICBzdHJ1Y3QgZWlyX3JlZ2lzdGVyIHNyYyA9IGdldF9uaXJfc3JjKGN0eCwgJmluc3Ry
LT5zcmNbMF0sIGluc3RyLT5udW1fY29tcG9uZW50cyk7CisKKyAgICAgIHN0cnVjdCBlaXJfcmVn
aXN0ZXIgZHN0ID0geworICAgICAgICAgLmluZGV4ID0gaWR4LAorICAgICAgICAgLnR5cGUgPSBF
SVJfUkVHX1RFTVAsCisgICAgICAgICAud3JpdGVtYXNrID0gZWlyX3dyaXRlbWFza19mb3Jfc2l6
ZShpbnN0ci0+bnVtX2NvbXBvbmVudHMpLAorICAgICAgfTsKKworICAgICAgZWlyX01PVihjdHgt
PmJsb2NrLCAmZHN0LCAmc3JjKTsKKworICAgICAgYnJlYWs7CisgICB9CisKKyAgIGNhc2Ugbmly
X2ludHJpbnNpY19ub3A6CisgICAgICBlaXJfTk9QKGN0eC0+YmxvY2spOworICAgICAgYnJlYWs7
CisKKyAgIGRlZmF1bHQ6CisgICAgICBjb21waWxlX2Vycm9yKGN0eCwgIlVuaGFuZGxlZCBpbnRy
aW5zaWMgdHlwZTogJXNcbiIsIGluZm8tPm5hbWUpOworICAgICAgYnJlYWs7CisgICB9Cit9CisK
K3N0YXRpYyB2b2lkCitlbWl0X3RleChzdHJ1Y3QgZWlyX2NvbnRleHQgKmN0eCwgbmlyX3RleF9p
bnN0ciAqdGV4KQoreworICAgY29uc3QgbmlyX29wX2luZm8gKmluZm8gPSAmbmlyX29wX2luZm9z
W3RleC0+b3BdOworICAgc3RydWN0IGVpcl9yZWdpc3RlciBzYW1wbGVyOworICAgc3RydWN0IGVp
cl9yZWdpc3RlciBjb29yZGluYXRlOworICAgc3RydWN0IGVpcl9yZWdpc3RlciBiaWFzOworICAg
TUFZQkVfVU5VU0VEIHN0cnVjdCBlaXJfcmVnaXN0ZXIgbG9kOworCisgICBzdHJ1Y3QgZWlyX3Jl
Z2lzdGVyIGRzdDsKKyAgIGRzdCA9IGdldF9uaXJfZGVzdChjdHgsICZ0ZXgtPmRlc3QpOworICAg
ZHN0LndyaXRlbWFzayA9IElOU1RfQ09NUFNfWCB8IElOU1RfQ09NUFNfWSB8IElOU1RfQ09NUFNf
WiB8IElOU1RfQ09NUFNfVzsKKworICAgc2FtcGxlci50eXBlID0gRUlSX1JFR19TQU1QTEVSOwor
ICAgc2FtcGxlci5pbmRleCA9IHRleC0+dGV4dHVyZV9pbmRleDsKKyAgIHNhbXBsZXIuc3dpenps
ZSA9IElOU1RfU1dJWl9JREVOVElUWTsKKyAgIC8qIFRPRE86IGFtb2RlICovCisKKyAgIGZvciAo
dW5zaWduZWQgaSA9IDA7IGkgPCB0ZXgtPm51bV9zcmNzOyBpKyspIHsKKyAgICAgIGNvbnN0IHVu
c2lnbmVkIHNyY19zaXplID0gbmlyX3RleF9pbnN0cl9zcmNfc2l6ZSh0ZXgsIGkpOworCisgICAg
ICBzd2l0Y2ggKHRleC0+c3JjW2ldLnNyY190eXBlKSB7CisgICAgICBjYXNlIG5pcl90ZXhfc3Jj
X2Nvb3JkOgorICAgICAgICAgY29vcmRpbmF0ZSA9IGdldF9uaXJfc3JjKGN0eCwgJnRleC0+c3Jj
W2ldLnNyYywgc3JjX3NpemUpOworICAgICAgICAgY29vcmRpbmF0ZS5zd2l6emxlID0gSU5TVF9T
V0laX0lERU5USVRZOworICAgICAgICAgYnJlYWs7CisKKyAgICAgIGNhc2UgbmlyX3RleF9zcmNf
cHJvamVjdG9yOgorICAgICAgICAgdW5yZWFjaGFibGUoIlNob3VsZCBiZSBsb3dlcmVkIGJ5IG5p
cl9sb3dlcl90ZXgiKTsKKyAgICAgICAgIGJyZWFrOworCisgICAgICBjYXNlIG5pcl90ZXhfc3Jj
X2JpYXM6CisgICAgICAgICBiaWFzID0gZ2V0X25pcl9zcmMoY3R4LCAmdGV4LT5zcmNbaV0uc3Jj
LCBzcmNfc2l6ZSk7CisgICAgICAgICBicmVhazsKKworICAgICAgY2FzZSBuaXJfdGV4X3NyY19s
b2Q6CisgICAgICAgICBsb2QgPSBnZXRfbmlyX3NyYyhjdHgsICZ0ZXgtPnNyY1tpXS5zcmMsIHNy
Y19zaXplKTsKKyAgICAgICAgIGJyZWFrOworCisgICAgICBkZWZhdWx0OgorICAgICAgICAgY29t
cGlsZV9lcnJvcihjdHgsICJVbmhhbmRsZWQgTklSIHRleCBzcmMgdHlwZTogJWRcbiIsCisgICAg
ICAgICAgICAgICAgICAgICAgIHRleC0+c3JjW2ldLnNyY190eXBlKTsKKyAgICAgICAgIHJldHVy
bjsKKyAgICAgIH0KKyAgIH0KKworICAgc3dpdGNoICh0ZXgtPm9wKSB7CisgICBjYXNlIG5pcl90
ZXhvcF90ZXg6CisgICAgICBlaXJfVEVYTEQoY3R4LT5ibG9jaywgJmRzdCwgJnNhbXBsZXIsICZj
b29yZGluYXRlKTsKKyAgICAgIGJyZWFrOworCisgICBjYXNlIG5pcl90ZXhvcF90eGI6CisgICAg
ICBlaXJfVEVYTERCKGN0eC0+YmxvY2ssICZkc3QsICZzYW1wbGVyLCAmYmlhcyk7CisgICAgICBi
cmVhazsKKworICAgY2FzZSBuaXJfdGV4b3BfdHhsOgorICAgICAgZWlyX1RFWExETChjdHgtPmJs
b2NrLCAmZHN0LCAmc2FtcGxlciwgJmNvb3JkaW5hdGUpOworICAgICAgYnJlYWs7CisKKyAgIGNh
c2UgbmlyX3RleG9wX3R4czogeworICAgICAgICAgY29uc3QgaW50IGRlc3Rfc2l6ZSA9IG5pcl90
ZXhfaW5zdHJfZGVzdF9zaXplKHRleCk7CisgICAgICAgICBjb25zdCB1bnNpZ25lZCB1bml0ID0g
dGV4LT50ZXh0dXJlX2luZGV4OworCisgICAgICAgICBhc3NlcnQoZGVzdF9zaXplIDwgMyk7CisK
KyAgICAgICAgIGNvbnN0IHVpbnQzMl90IHZbXSA9IHsKKyAgICAgICAgICAgIHVuaXQsCisgICAg
ICAgICAgICB1bml0LAorICAgICAgICAgICAgdW5pdCwKKyAgICAgICAgIH07CisKKyAgICAgICAg
IGNvbnN0IGVudW0gZWlyX3VuaWZvcm1fY29udGVudHMgY1tdID0geworICAgICAgICAgICAgRUlS
X1VOSUZPUk1fSU1BR0VfV0lEVEgsCisgICAgICAgICAgICBFSVJfVU5JRk9STV9JTUFHRV9IRUlH
SFQsCisgICAgICAgICAgICBFSVJfVU5JRk9STV9JTUFHRV9ERVBUSCwKKyAgICAgICAgIH07CisK
KyAgICAgICAgIC8qIHdlIGRvIG5vdCBzdXBwb3J0IGxvZCB5ZXQgKi8KKyAgICAgICAgIGFzc2Vy
dChuaXJfdGV4X2luc3RyX3NyY19pbmRleCh0ZXgsIG5pcl90ZXhfc3JjX2xvZCkgPT0gMCk7CisK
KyAgICAgICAgIHN0cnVjdCBlaXJfcmVnaXN0ZXIgc2l6ZSA9IGVpcl91bmlmb3JtX3JlZ2lzdGVy
X3ZlYzQoY3R4LT5pciwgMywgYywgdik7CisKKyAgICAgICAgIC8qIFRPRE86IGdldCByaWQgb2Yg
bW92IGFuZCB1c2UgdW5pZm9ybSBkaXJlY3RseSAqLworICAgICAgICAgZWlyX01PVihjdHgtPmJs
b2NrLCAmZHN0LCAmc2l6ZSk7CisgICAgICB9CisgICAgICBicmVhazsKKworICAgZGVmYXVsdDoK
KyAgICAgIGNvbXBpbGVfZXJyb3IoY3R4LCAiVW5oYW5kbGVkIE5JUiB0ZXggb3A6ICVkXG4iLCBp
bmZvLT5uYW1lKTsKKyAgICAgIGJyZWFrOworICAgfQorfQorCitzdGF0aWMgdm9pZAorZW1pdF9q
dW1wKHN0cnVjdCBlaXJfY29udGV4dCAqY3R4LCBuaXJfanVtcF9pbnN0ciAqanVtcCkKK3sKKyAg
IGNvbXBpbGVfZXJyb3IoY3R4LCAiVW5oYW5kbGVkIE5JUiBqdW1wIHR5cGU6ICVkXG4iLCBqdW1w
LT50eXBlKTsKK30KKworc3RhdGljIHZvaWQKK2VtaXRfdW5kZWYoc3RydWN0IGVpcl9jb250ZXh0
ICpjdHgsIG5pcl9zc2FfdW5kZWZfaW5zdHIgKnVuZGVmKQoreworICAgY3R4LT5uaXJfc3NhX3Zh
bHVlc1t1bmRlZi0+ZGVmLmluZGV4XSA9IGVpcl90ZW1wX3JlZ2lzdGVyKGN0eC0+aXIsIHVuZGVm
LT5kZWYubnVtX2NvbXBvbmVudHMpOworfQorCitzdGF0aWMgdm9pZAorZW1pdF9pbnN0cihzdHJ1
Y3QgZWlyX2NvbnRleHQgKmN0eCwgbmlyX2luc3RyICppbnN0cikKK3sKKyAgIHN3aXRjaCAoaW5z
dHItPnR5cGUpIHsKKyAgIGNhc2UgbmlyX2luc3RyX3R5cGVfYWx1OgorICAgICAgZW1pdF9hbHUo
Y3R4LCBuaXJfaW5zdHJfYXNfYWx1KGluc3RyKSk7CisgICAgICBicmVhazsKKyAgIGNhc2Ugbmly
X2luc3RyX3R5cGVfaW50cmluc2ljOgorICAgICAgZW1pdF9pbnRyaW5zaWMoY3R4LCBuaXJfaW5z
dHJfYXNfaW50cmluc2ljKGluc3RyKSk7CisgICAgICBicmVhazsKKyAgIGNhc2UgbmlyX2luc3Ry
X3R5cGVfbG9hZF9jb25zdDoKKyAgICAgIC8qIGRlYWx0IHdpdGggd2hlbiB1c2luZyBuaXJfc3Jj
ICovCisgICAgICBicmVhazsKKyAgIGNhc2UgbmlyX2luc3RyX3R5cGVfdGV4OgorICAgICAgZW1p
dF90ZXgoY3R4LCBuaXJfaW5zdHJfYXNfdGV4KGluc3RyKSk7CisgICAgICBicmVhazsKKyAgIGNh
c2UgbmlyX2luc3RyX3R5cGVfanVtcDoKKyAgICAgIGVtaXRfanVtcChjdHgsIG5pcl9pbnN0cl9h
c19qdW1wKGluc3RyKSk7CisgICAgICBicmVhazsKKyAgIGNhc2UgbmlyX2luc3RyX3R5cGVfc3Nh
X3VuZGVmOgorICAgICAgZW1pdF91bmRlZihjdHgsIG5pcl9pbnN0cl9hc19zc2FfdW5kZWYoaW5z
dHIpKTsKKyAgICAgIGJyZWFrOworICAgY2FzZSBuaXJfaW5zdHJfdHlwZV9waGk6CisgICAgICAv
KiB3ZSBoYXZlIGNvbnZlcnRlZCBwaGkgd2VicyB0byByZWdzIGluIE5JUiBieSBub3cgKi8KKyAg
ICAgIGNvbXBpbGVfZXJyb3IoY3R4LCAiVW5leHBlY3RlZCBOSVIgaW5zdHJ1Y3Rpb24gdHlwZTog
JWRcbiIsIGluc3RyLT50eXBlKTsKKyAgICAgIGJyZWFrOworICAgY2FzZSBuaXJfaW5zdHJfdHlw
ZV9kZXJlZjoKKyAgIGNhc2UgbmlyX2luc3RyX3R5cGVfY2FsbDoKKyAgIGNhc2UgbmlyX2luc3Ry
X3R5cGVfcGFyYWxsZWxfY29weToKKyAgICAgIGNvbXBpbGVfZXJyb3IoY3R4LCAiVW5oYW5kbGVk
IE5JUiBpbnN0cnVjdGlvbiB0eXBlOiAlZFxuIiwgaW5zdHItPnR5cGUpOworICAgICAgYnJlYWs7
CisgICB9Cit9CisKK3N0YXRpYyB2b2lkIGVtaXRfY2ZfbGlzdChzdHJ1Y3QgZWlyX2NvbnRleHQg
KmN0eCwgc3RydWN0IGV4ZWNfbGlzdCAqbGlzdCk7CisKK3N0YXRpYyB2b2lkCitlbWl0X2Jsb2Nr
KHN0cnVjdCBlaXJfY29udGV4dCAqY3R4LCBuaXJfYmxvY2sgKm5ibG9jaykKK3sKKyAgIG5pcl9m
b3JlYWNoX2luc3RyKGluc3RyLCBuYmxvY2spIHsKKyAgICAgIGVtaXRfaW5zdHIoY3R4LCBpbnN0
cik7CisgICAgICBpZiAoY3R4LT5lcnJvcikKKyAgICAgICAgIHJldHVybjsKKyAgIH0KK30KKwor
c3RhdGljIHZvaWQKK2VtaXRfaWYoc3RydWN0IGVpcl9jb250ZXh0ICpjdHgsIG5pcl9pZiAqbmlm
KQoreworICAgbmlyX2Jsb2NrICpuaXJfZWxzZV9ibG9jayA9IG5pcl9pZl9maXJzdF9lbHNlX2Js
b2NrKG5pZik7CisgICBib29sIGVtcHR5X2Vsc2VfYmxvY2sgPSAobmlyX2Vsc2VfYmxvY2sgPT0g
bmlyX2lmX2xhc3RfZWxzZV9ibG9jayhuaWYpICYmCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICBleGVjX2xpc3RfaXNfZW1wdHkoJm5pcl9lbHNlX2Jsb2NrLT5pbnN0cl9saXN0KSk7CisKKyAg
IHN0cnVjdCBlaXJfYmxvY2sgKnRoZW5fYmxvY2sgPSBlaXJfYmxvY2tfY3JlYXRlKGN0eC0+aXIp
OworICAgc3RydWN0IGVpcl9ibG9jayAqYWZ0ZXJfYmxvY2sgPSBlaXJfYmxvY2tfY3JlYXRlKGN0
eC0+aXIpOworICAgc3RydWN0IGVpcl9ibG9jayAqZWxzZV9ibG9jayA9IE5VTEw7CisKKyAgIGlm
IChlbXB0eV9lbHNlX2Jsb2NrKQorICAgICAgZWxzZV9ibG9jayA9IGFmdGVyX2Jsb2NrOworICAg
ZWxzZQorICAgICAgZWxzZV9ibG9jayA9IGVpcl9ibG9ja19jcmVhdGUoY3R4LT5pcik7CisKKyAg
IGVpcl9saW5rX2Jsb2NrcyhjdHgtPmJsb2NrLCBlbHNlX2Jsb2NrKTsKKyAgIGVpcl9saW5rX2Js
b2NrcyhjdHgtPmJsb2NrLCB0aGVuX2Jsb2NrKTsKKworICAgYXNzZXJ0KG5pZi0+Y29uZGl0aW9u
LmlzX3NzYSk7CisgICBhc3NlcnQobmlmLT5jb25kaXRpb24uc3NhLT5wYXJlbnRfaW5zdHItPnR5
cGUgPT0gbmlyX2luc3RyX3R5cGVfYWx1KTsKKworICAgbmlyX2FsdV9pbnN0ciAqcGFyZW50X2Fs
dSA9IG5pcl9pbnN0cl9hc19hbHUobmlmLT5jb25kaXRpb24uc3NhLT5wYXJlbnRfaW5zdHIpOwor
CisgICBzdHJ1Y3QgZWlyX3JlZ2lzdGVyIHNyYzAsIHNyYzE7CisgICBuaXJfYWx1X3NyY190b19l
aXIoY3R4LCAmcGFyZW50X2FsdS0+c3JjWzBdLCAmc3JjMCk7CisgICBuaXJfYWx1X3NyY190b19l
aXIoY3R4LCAmcGFyZW50X2FsdS0+c3JjWzFdLCAmc3JjMSk7CisKKyAgIHN0cnVjdCBlaXJfaW5z
dHJ1Y3Rpb24gKmluc3RyID0gZWlyX0JSQU5DSChjdHgtPmJsb2NrLCAmc3JjMCwgJnNyYzEpOwor
CisgICBzd2l0Y2ggKHBhcmVudF9hbHUtPm9wKSB7CisgICBjYXNlIG5pcl9vcF9mZXE6CisgICBj
YXNlIG5pcl9vcF9zZXE6CisgICAgICBpbnN0ci0+Z2MuY29uZGl0aW9uID0gR0NfQ09ORF9ORTsK
KyAgICAgIGJyZWFrOworCisgICBjYXNlIG5pcl9vcF9mbmU6CisgICBjYXNlIG5pcl9vcF9zbmU6
CisgICAgICBpbnN0ci0+Z2MuY29uZGl0aW9uID0gR0NfQ09ORF9FUTsKKyAgICAgIGJyZWFrOwor
CisgICBjYXNlIG5pcl9vcF9mbHQ6CisgICBjYXNlIG5pcl9vcF9zbHQ6CisgICAgICBpbnN0ci0+
Z2MuY29uZGl0aW9uID0gR0NfQ09ORF9HVDsKKyAgICAgIGJyZWFrOworCisgICBjYXNlIG5pcl9v
cF9mZ2U6CisgICBjYXNlIG5pcl9vcF9zZ2U6CisgICAgICBpbnN0ci0+Z2MuY29uZGl0aW9uID0g
R0NfQ09ORF9MRTsKKyAgICAgIGJyZWFrOworCisgICBkZWZhdWx0OgorICAgICAgdW5yZWFjaGFi
bGUoIm5vdCBzdXBwb3J0ZWQgb3BjIik7CisgICB9CisKKyAgIGN0eC0+YmxvY2sgPSB0aGVuX2Js
b2NrOworICAgZWlyX2xpbmtfYmxvY2tzKGN0eC0+YmxvY2ssIGFmdGVyX2Jsb2NrKTsKKyAgIGVt
aXRfY2ZfbGlzdChjdHgsICZuaWYtPnRoZW5fbGlzdCk7CisKKyAgIGlmICghZW1wdHlfZWxzZV9i
bG9jaykgeworICAgICAgY3R4LT5ibG9jayA9IGVsc2VfYmxvY2s7CisgICAgICBlbWl0X2NmX2xp
c3QoY3R4LCAmbmlmLT5lbHNlX2xpc3QpOworCisgICAgICBlaXJfbGlua19ibG9ja3MoY3R4LT5i
bG9jaywgYWZ0ZXJfYmxvY2spOworICAgICAgZWlyX2xpbmtfYmxvY2tzKGN0eC0+YmxvY2ssIGVs
c2VfYmxvY2spOworICAgfQorCisgICBjdHgtPmJsb2NrID0gYWZ0ZXJfYmxvY2s7Cit9CisKK3N0
YXRpYyB2b2lkCitlbWl0X2xvb3Aoc3RydWN0IGVpcl9jb250ZXh0ICpjdHgsIG5pcl9sb29wICpu
bG9vcCkKK3sKKyAgIGVtaXRfY2ZfbGlzdChjdHgsICZubG9vcC0+Ym9keSk7CisKKyAgIGN0eC0+
dmFyaWFudC0+bnVtX2xvb3BzKys7Cit9CisKK3N0YXRpYyB2b2lkCitlbWl0X2NmX2xpc3Qoc3Ry
dWN0IGVpcl9jb250ZXh0ICpjdHgsIHN0cnVjdCBleGVjX2xpc3QgKmxpc3QpCit7CisgICBmb3Jl
YWNoX2xpc3RfdHlwZWQobmlyX2NmX25vZGUsIG5vZGUsIG5vZGUsIGxpc3QpIHsKKyAgICAgIHN3
aXRjaCAobm9kZS0+dHlwZSkgeworICAgICAgY2FzZSBuaXJfY2Zfbm9kZV9ibG9jazoKKyAgICAg
ICAgIGVtaXRfYmxvY2soY3R4LCBuaXJfY2Zfbm9kZV9hc19ibG9jayhub2RlKSk7CisgICAgICAg
ICBicmVhazsKKyAgICAgIGNhc2UgbmlyX2NmX25vZGVfaWY6CisgICAgICAgICBlbWl0X2lmKGN0
eCwgbmlyX2NmX25vZGVfYXNfaWYobm9kZSkpOworICAgICAgICAgYnJlYWs7CisgICAgICBjYXNl
IG5pcl9jZl9ub2RlX2xvb3A6CisgICAgICAgICBlbWl0X2xvb3AoY3R4LCBuaXJfY2Zfbm9kZV9h
c19sb29wKG5vZGUpKTsKKyAgICAgICAgIGJyZWFrOworICAgICAgY2FzZSBuaXJfY2Zfbm9kZV9m
dW5jdGlvbjoKKyAgICAgICAgIGNvbXBpbGVfZXJyb3IoY3R4LCAiVE9ET1xuIik7CisgICAgICAg
ICBicmVhazsKKyAgICAgIH0KKyAgIH0KK30KKworc3RhdGljIHZvaWQKK2VtaXRfZnVuY3Rpb24o
c3RydWN0IGVpcl9jb250ZXh0ICpjdHgsIG5pcl9mdW5jdGlvbl9pbXBsICppbXBsKQoreworICAg
ZW1pdF9jZl9saXN0KGN0eCwgJmltcGwtPmJvZHkpOworfQorCitzdGF0aWMgdm9pZAorc2V0dXBf
aW5wdXQoc3RydWN0IGVpcl9jb250ZXh0ICpjdHgsIG5pcl92YXJpYWJsZSAqaW4pCit7CisgICB1
bnNpZ25lZCBhcnJheV9sZW4gPSBNQVgyKGdsc2xfZ2V0X2xlbmd0aChpbi0+dHlwZSksIDEpOwor
ICAgdW5zaWduZWQgbmNvbXAgPSBnbHNsX2dldF9jb21wb25lbnRzKGluLT50eXBlKTsKKyAgIHVu
c2lnbmVkIG4gPSBpbi0+ZGF0YS5kcml2ZXJfbG9jYXRpb247CisgICB1bnNpZ25lZCBzbG90ID0g
aW4tPmRhdGEubG9jYXRpb247CisKKyAgIERCRyhjdHgtPmNvbXBpbGVyLCAiOyBpbjogc2xvdD0l
dSwgbGVuPSV1eCV1LCBkcnZsb2M9JXUiLAorICAgICAgICAgc2xvdCwgYXJyYXlfbGVuLCBuY29t
cCwgbik7CisKKyAgIGNvbXBpbGVfYXNzZXJ0KGN0eCwgbiA8IEFSUkFZX1NJWkUoY3R4LT5pci0+
aW5wdXRzKSk7CisKKyAgIGlmIChjdHgtPnMtPmluZm8uc3RhZ2UgPT0gTUVTQV9TSEFERVJfRlJB
R01FTlQpIHsKKyAgICAgIGVpcl9hc3NpZ25faW5wdXQoY3R4LT5pciwgbiwgc2xvdCwgbmNvbXAp
OworICAgfSBlbHNlIGlmIChjdHgtPnMtPmluZm8uc3RhZ2UgPT0gTUVTQV9TSEFERVJfVkVSVEVY
KSB7CisgICAgICBlaXJfYXNzaWduX2lucHV0KGN0eC0+aXIsIG4sIHNsb3QsIG5jb21wKTsKKyAg
IH0gZWxzZSB7CisgICAgICBjb21waWxlX2Vycm9yKGN0eCwgInVua25vd24gc2hhZGVyIHR5cGU6
ICVkXG4iLCBjdHgtPnMtPmluZm8uc3RhZ2UpOworICAgfQorfQorCitzdGF0aWMgdm9pZAorc2V0
dXBfb3V0cHV0KHN0cnVjdCBlaXJfY29udGV4dCAqY3R4LCBuaXJfdmFyaWFibGUgKm91dCkKK3sK
KyAgIHVuc2lnbmVkIGFycmF5X2xlbiA9IE1BWDIoZ2xzbF9nZXRfbGVuZ3RoKG91dC0+dHlwZSks
IDEpOworICAgdW5zaWduZWQgbmNvbXAgPSBnbHNsX2dldF9jb21wb25lbnRzKG91dC0+dHlwZSk7
CisgICB1bnNpZ25lZCBuID0gb3V0LT5kYXRhLmRyaXZlcl9sb2NhdGlvbjsKKyAgIHVuc2lnbmVk
IHNsb3QgPSBvdXQtPmRhdGEubG9jYXRpb247CisKKyAgIERCRyhjdHgtPmNvbXBpbGVyLCAiOyBv
dXQ6IHNsb3Q9JXUsIGxlbj0ldXgldSwgZHJ2bG9jPSV1IiwKKyAgICAgICAgIHNsb3QsIGFycmF5
X2xlbiwgbmNvbXAsIG4pOworCisgICBjb21waWxlX2Fzc2VydChjdHgsIG4gPCBBUlJBWV9TSVpF
KGN0eC0+aXItPm91dHB1dHMpKTsKKworICAgaWYgKGN0eC0+cy0+aW5mby5zdGFnZSA9PSBNRVNB
X1NIQURFUl9GUkFHTUVOVCkgeworICAgICAgc3dpdGNoIChzbG90KSB7CisgICAgICBjYXNlIEZS
QUdfUkVTVUxUX0RFUFRIOgorICAgICAgICAgZWlyX2Fzc2lnbl9vdXRwdXQoY3R4LT5pciwgbiwg
c2xvdCwgbmNvbXApOworICAgICAgICAgYnJlYWs7CisKKyAgICAgIGNhc2UgRlJBR19SRVNVTFRf
Q09MT1I6CisgICAgICAgICBlaXJfYXNzaWduX291dHB1dChjdHgtPmlyLCBuLCBzbG90LCBuY29t
cCk7CisgICAgICAgICBicmVhazsKKworICAgICAgZGVmYXVsdDoKKyAgICAgICAgIGlmIChzbG90
ID49IEZSQUdfUkVTVUxUX0RBVEEwKSB7CisgICAgICAgICAgICBlaXJfYXNzaWduX291dHB1dChj
dHgtPmlyLCBuLCBzbG90LCBuY29tcCk7CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgIH0K
KworICAgICAgICAgY29tcGlsZV9lcnJvcihjdHgsICJ1bmtub3duIEZTIG91dHB1dCBuYW1lOiAl
c1xuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgZ2xfZnJhZ19yZXN1bHRfbmFtZShzbG90KSk7
CisgICAgICB9CisgICB9IGVsc2UgaWYgKGN0eC0+cy0+aW5mby5zdGFnZSA9PSBNRVNBX1NIQURF
Ul9WRVJURVgpIHsKKyAgICAgIHN3aXRjaCAoc2xvdCkgeworICAgICAgY2FzZSBWQVJZSU5HX1NM
T1RfUE9TOgorICAgICAgICAgZWlyX2Fzc2lnbl9vdXRwdXQoY3R4LT5pciwgbiwgc2xvdCwgbmNv
bXApOworICAgICAgICAgYnJlYWs7CisKKyAgICAgIGNhc2UgVkFSWUlOR19TTE9UX1BTSVo6Cisg
ICAgICAgICBlaXJfYXNzaWduX291dHB1dChjdHgtPmlyLCBuLCBzbG90LCBuY29tcCk7CisgICAg
ICAgICBicmVhazsKKworICAgICAgY2FzZSBWQVJZSU5HX1NMT1RfQ09MMDoKKyAgICAgICAgIGVp
cl9hc3NpZ25fb3V0cHV0KGN0eC0+aXIsIG4sIHNsb3QsIG5jb21wKTsKKyAgICAgICAgIGJyZWFr
OworCisgICAgICBkZWZhdWx0OgorICAgICAgICAgaWYgKHNsb3QgPj0gVkFSWUlOR19TTE9UX1ZB
UjApIHsKKyAgICAgICAgICAgIGVpcl9hc3NpZ25fb3V0cHV0KGN0eC0+aXIsIG4sIHNsb3QsIG5j
b21wKTsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICAgfQorCisgICAgICAgICBpZiAoKFZB
UllJTkdfU0xPVF9URVgwIDw9IHNsb3QpICYmIChzbG90IDw9IFZBUllJTkdfU0xPVF9URVg3KSkg
eworICAgICAgICAgICAgZWlyX2Fzc2lnbl9vdXRwdXQoY3R4LT5pciwgbiwgc2xvdCwgbmNvbXAp
OworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgICB9CisKKyAgICAgICAgIGNvbXBpbGVfZXJy
b3IoY3R4LCAidW5rbm93biBWUyBvdXRwdXQgbmFtZTogJXNcbiIsCisgICAgICAgICAgICAgICBn
bF92YXJ5aW5nX3Nsb3RfbmFtZShzbG90KSk7CisgICAgICB9CisgICB9IGVsc2UgeworICAgICAg
Y29tcGlsZV9lcnJvcihjdHgsICJ1bmtub3duIHNoYWRlciB0eXBlOiAlZFxuIiwgY3R4LT5zLT5p
bmZvLnN0YWdlKTsKKyAgIH0KK30KKworc3RhdGljIGludAorbWF4X2RydmxvYyhzdHJ1Y3QgZXhl
Y19saXN0ICp2YXJzKQoreworICAgaW50IGRydmxvYyA9IC0xOworCisgICBuaXJfZm9yZWFjaF92
YXJpYWJsZSh2YXIsIHZhcnMpCisgICAgICBkcnZsb2MgPSBNQVgyKGRydmxvYywgKGludCl2YXIt
PmRhdGEuZHJpdmVyX2xvY2F0aW9uKTsKKworICAgcmV0dXJuIGRydmxvYzsKK30KKworc3RhdGlj
IHZvaWQKK2VtaXRfaW5zdHJ1Y3Rpb25zKHN0cnVjdCBlaXJfY29udGV4dCAqY3R4KQoreworICAg
Y29uc3QgdW5zaWduZWQgbmlucHV0cyAgPSBtYXhfZHJ2bG9jKCZjdHgtPnMtPmlucHV0cykgKyAx
OworICAgY29uc3QgdW5zaWduZWQgbm91dHB1dHMgPSBtYXhfZHJ2bG9jKCZjdHgtPnMtPm91dHB1
dHMpICsgMTsKKworICAgLy8ga2VlcCB0MC4udG4gcmVnaXN0ZXJzIHJlc2VydmVkIGZvciBpbnB1
dHMgYW5kIG91dHB1dHMKKyAgIGNvbnN0IHVuc2lnbmVkIHJlc2VydmVkID0gTUFYMihuaW5wdXRz
LCBub3V0cHV0cyk7CisgICBmb3IgKHVuc2lnbmVkIGkgPSAwOyBpIDwgcmVzZXJ2ZWQ7IGkrKykK
KyAgICAgIGVpcl90ZW1wX3JlZ2lzdGVyKGN0eC0+aXIsIDQpOworCisgICBuaXJfZnVuY3Rpb25f
aW1wbCAqZnhuID0gbmlyX3NoYWRlcl9nZXRfZW50cnlwb2ludChjdHgtPnMpOworCisgICBjdHgt
Pm5pcl9sb2NhbHMgPSByYWxsb2NfYXJyYXkoY3R4LCBzdHJ1Y3QgZWlyX3JlZ2lzdGVyLCBmeG4t
PnJlZ19hbGxvYyk7CisgICBjdHgtPm5pcl9zc2FfdmFsdWVzID0gcmFsbG9jX2FycmF5KGN0eCwg
c3RydWN0IGVpcl9yZWdpc3RlciwgZnhuLT5zc2FfYWxsb2MpOworCisgICBmb3JlYWNoX2xpc3Rf
dHlwZWQobmlyX3JlZ2lzdGVyLCByZWcsIG5vZGUsICZmeG4tPnJlZ2lzdGVycykgeworICAgICAg
YXNzZXJ0KHJlZy0+bnVtX2FycmF5X2VsZW1zID09IDApOworICAgICAgYXNzZXJ0KHJlZy0+Yml0
X3NpemUgPT0gMzIpOworCisgICAgICBjdHgtPm5pcl9sb2NhbHNbcmVnLT5pbmRleF0gPSBlaXJf
dGVtcF9yZWdpc3RlcihjdHgtPmlyLCA0KTsKKyAgIH0KKworICAgaWYgKGN0eC0+cy0+bnVtX3Vu
aWZvcm1zID4gMCkKKyAgICAgIGN0eC0+dW5pZm9ybXMgPSBjdHgtPnMtPm51bV91bmlmb3JtcyAv
IDE2OworCisgICBuaXJfZm9yZWFjaF92YXJpYWJsZSh2YXIsICZjdHgtPnMtPmlucHV0cykKKyAg
ICAgIHNldHVwX2lucHV0KGN0eCwgdmFyKTsKKworICAgbmlyX2ZvcmVhY2hfdmFyaWFibGUodmFy
LCAmY3R4LT5zLT5vdXRwdXRzKQorICAgICAgc2V0dXBfb3V0cHV0KGN0eCwgdmFyKTsKKworICAg
ZW1pdF9mdW5jdGlvbihjdHgsIGZ4bik7Cit9CisKK3N0YXRpYyB2b2lkCitzZXR1cF9zcGVjaWFs
X3ZlcnRfcmVnaXN0ZXIoY29uc3Qgc3RydWN0IGVpciAqaXIsIHVuc2lnbmVkIGksIHN0cnVjdCBl
aXJfc2hhZGVyX3ZhcmlhbnQgKnYpCit7CisgICBjb25zdCBpbnQgcmVnID0gaXItPm91dHB1dHNb
aV0ucmVnOworCisgICBzd2l0Y2ggKGlyLT5vdXRwdXRzW2ldLnNsb3QpIHsKKyAgIGNhc2UgVkFS
WUlOR19TTE9UX1BPUzoKKyAgICAgIHYtPnZzX3Bvc19vdXRfcmVnID0gcmVnOworICAgICAgYnJl
YWs7CisgICBkZWZhdWx0OgorICAgICAgLyogbm90aGluZyB0byBkbyAqLworICAgICAgYnJlYWs7
CisgICB9Cit9CisKK3N0YXRpYyB2b2lkCitzZXR1cF9zcGVjaWFsX2ZyYWdfcmVnaXN0ZXIoY29u
c3Qgc3RydWN0IGVpciAqaXIsIHVuc2lnbmVkIGksIHN0cnVjdCBlaXJfc2hhZGVyX3ZhcmlhbnQg
KnYpCit7CisgICBjb25zdCBpbnQgcmVnID0gaXItPm91dHB1dHNbaV0ucmVnOworCisgICBzd2l0
Y2ggKGlyLT5vdXRwdXRzW2ldLnNsb3QpIHsKKyAgIGNhc2UgRlJBR19SRVNVTFRfREVQVEg6Cisg
ICAgICB2LT5mc19kZXB0aF9vdXRfcmVnID0gcmVnOworICAgICAgYnJlYWs7CisgICBjYXNlIEZS
QUdfUkVTVUxUX0NPTE9SOgorICAgICAgdi0+ZnNfY29sb3Jfb3V0X3JlZyA9IHJlZzsKKyAgICAg
IGJyZWFrOworICAgZGVmYXVsdDoKKyAgICAgIC8qIG5vdGhpbmcgdG8gZG8gKi8KKyAgICAgIGJy
ZWFrOworICAgfQorfQorCitzdGF0aWMgdm9pZAorc2V0dXBfc2hhZGVyX2lvKHN0cnVjdCBlaXJf
Y29udGV4dCAqY3R4LCBzdHJ1Y3QgZWlyX3NoYWRlcl92YXJpYW50ICp2KQoreworICAgY29uc3Qg
c3RydWN0IGVpciAqaXIgPSBjdHgtPmlyOworCisgICBmb3IgKHVuc2lnbmVkIGkgPSAwOyBpIDwg
aXItPm51bV9pbnB1dHM7IGkrKykgeworICAgICAgdi0+aW5wdXRzW2ldLnJlZyA9IGlyLT5pbnB1
dHNbaV0ucmVnOworICAgICAgdi0+aW5wdXRzW2ldLnNsb3QgPSBpci0+aW5wdXRzW2ldLnNsb3Q7
CisgICAgICB2LT5pbnB1dHNbaV0ubmNvbXAgPSBpci0+aW5wdXRzW2ldLm5jb21wOworCisgICAg
ICAvKiBUT0RPOgorICAgICAgdi0+aW5wdXRzW25dLmludGVycG9sYXRlID0gaW4tPmRhdGEuaW50
ZXJwb2xhdGlvbjsKKyAgICAgICovCisgICB9CisKKyAgIGZvciAodW5zaWduZWQgaSA9IDA7IGkg
PCBpci0+bnVtX291dHB1dHM7IGkrKykgeworICAgICAgdi0+b3V0cHV0c1tpXS5yZWcgPSBpci0+
b3V0cHV0c1tpXS5yZWc7CisgICAgICB2LT5vdXRwdXRzW2ldLnNsb3QgPSBpci0+b3V0cHV0c1tp
XS5zbG90OworICAgICAgdi0+b3V0cHV0c1tpXS5uY29tcCA9IGlyLT5vdXRwdXRzW2ldLm5jb21w
OworCisgICAgICBpZiAodi0+c2hhZGVyLT50eXBlID09IE1FU0FfU0hBREVSX1ZFUlRFWCkKKyAg
ICAgICAgIHNldHVwX3NwZWNpYWxfdmVydF9yZWdpc3RlcihpciwgaSwgdik7CisgICAgICBlbHNl
IGlmICh2LT5zaGFkZXItPnR5cGUgPT0gTUVTQV9TSEFERVJfRlJBR01FTlQpCisgICAgICAgICBz
ZXR1cF9zcGVjaWFsX2ZyYWdfcmVnaXN0ZXIoaXIsIGksIHYpOworICAgfQorCisgICB2LT5udW1f
aW5wdXRzID0gaXItPm51bV9pbnB1dHM7CisgICB2LT5udW1fb3V0cHV0cyA9IGlyLT5udW1fb3V0
cHV0czsKK30KKworaW50CitlaXJfY29tcGlsZV9zaGFkZXJfbmlyKHN0cnVjdCBlaXJfY29tcGls
ZXIgKmNvbXBpbGVyLAorICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZWlyX3NoYWRlcl92
YXJpYW50ICp2KQoreworICAgaW50IHJldCA9IDA7CisgICBzdHJ1Y3QgZWlyX2NvbnRleHQgKmN0
eDsKKyAgIGJvb2wgc3VjY2VzczsKKworICAgYXNzZXJ0KCF2LT5pcik7CisgICBhc3NlcnQodi0+
c2hhZGVyLT5tZW1fY3R4KTsKKworICAgY3R4ID0gY29tcGlsZV9pbml0KGNvbXBpbGVyLCB2KTsK
KyAgIGlmICghY3R4KSB7CisgICAgICBEQkcoY29tcGlsZXIsICJJTklUIGZhaWxlZCEiKTsKKyAg
ICAgIHJldCA9IC0xOworICAgICAgZ290byBvdXQ7CisgICB9CisKKyAgIHYtPmlyID0gY3R4LT5p
cjsKKworICAgZW1pdF9pbnN0cnVjdGlvbnMoY3R4KTsKKworICAgaWYgKGN0eC0+ZXJyb3IpIHsK
KyAgICAgIERCRyhjb21waWxlciwgIkVNSVQgZmFpbGVkISIpOworICAgICAgcmV0ID0gLTE7Cisg
ICAgICBnb3RvIG91dDsKKyAgIH0KKworICAgaWYgKGVpcl9jb21waWxlcl9kZWJ1ZyAmIEVJUl9E
QkdfT1BUTVNHUykgeworICAgICAgcHJpbnRmKCJBRlRFUiBlbWl0dGluZzpcbiIpOworICAgICAg
ZWlyX3ByaW50KGN0eC0+aXIpOworICAgfQorCisgICBlaXJfbGVnYWxpemUoY3R4LT5pcik7Cisg
ICBpZiAoZWlyX2NvbXBpbGVyX2RlYnVnICYgRUlSX0RCR19PUFRNU0dTKSB7CisgICAgICBwcmlu
dGYoIkFGVEVSIGxlZ2FsaXphdGlvbjpcbiIpOworICAgICAgZWlyX3ByaW50KGN0eC0+aXIpOwor
ICAgfQorCisgICBlaXJfY2FsY3VsYXRlX2xpdmVfaW50ZXJ2YWxzKGN0eC0+aXIpOworICAgaWYg
KGVpcl9jb21waWxlcl9kZWJ1ZyAmIEVJUl9EQkdfT1BUTVNHUykgeworICAgICAgcHJpbnRmKCJB
RlRFUiBsaXZlLXJhbmdlczpcbiIpOworICAgICAgZWlyX3ByaW50KGN0eC0+aXIpOworICAgfQor
CisgICBzdWNjZXNzID0gZWlyX3JlZ2lzdGVyX2FsbG9jYXRlKGN0eC0+aXIsIHYtPnNoYWRlci0+
dHlwZSwgY3R4LT5jb21waWxlcik7CisgICBpZiAoIXN1Y2Nlc3MpIHsKKyAgICAgIERCRyhjb21w
aWxlciwgIlJBIGZhaWxlZCEiKTsKKyAgICAgIHJldCA9IC0xOworICAgICAgZ290byBvdXQ7Cisg
ICB9CisKKyAgIGlmIChlaXJfY29tcGlsZXJfZGVidWcgJiBFSVJfREJHX09QVE1TR1MpIHsKKyAg
ICAgIHByaW50ZigiQUZURVIgUkE6XG4iKTsKKyAgICAgIGVpcl9wcmludChjdHgtPmlyKTsKKyAg
IH0KKworICAgc2V0dXBfc2hhZGVyX2lvKGN0eCwgdik7CisKKyAgIHYtPm51bV90ZW1wcyA9IGN0
eC0+aXItPm51bV90ZW1wczsKKyAgIHYtPmNvbnN0X3NpemUgPSBjdHgtPmlyLT51bmlmb3JtX29m
ZnNldDsKKworICAgdXRpbF9keW5hcnJheV9jbG9uZSgmdi0+dW5pZm9ybXMsIHYtPnNoYWRlci0+
bWVtX2N0eCwgJmN0eC0+aXItPnVuaWZvcm1fYWxsb2MpOworCitvdXQ6CisgICBpZiAocmV0KSB7
CisgICAgICBpZiAodi0+aXIpCisgICAgICAgICBlaXJfZGVzdHJveSh2LT5pcik7CisgICAgICB2
LT5pciA9IE5VTEw7CisgICB9CisKKyAgIGNvbXBpbGVfZnJlZShjdHgpOworCisgICByZXR1cm4g
cmV0OworfQpkaWZmIC0tZ2l0IGEvc3JjL2V0bmF2aXYvY29tcGlsZXIvZWlyX3NoYWRlci5jIGIv
c3JjL2V0bmF2aXYvY29tcGlsZXIvZWlyX3NoYWRlci5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Cmlu
ZGV4IDAwMDAwMDAwMDAwLi43YWQ0MGJlNWNjNgotLS0gL2Rldi9udWxsCisrKyBiL3NyYy9ldG5h
dml2L2NvbXBpbGVyL2Vpcl9zaGFkZXIuYwpAQCAtMCwwICsxLDMxMiBAQAorLyoKKyAqIENvcHly
aWdodCAoYykgMjAxOCBFdG5hdml2IFByb2plY3QKKyAqIENvcHlyaWdodCAoQykgMjAxOCBab2Rp
YWMgSW5mbGlnaHQgSW5ub3ZhdGlvbnMKKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFu
dGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICogY29weSBv
ZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAi
U29mdHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rp
b24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8gdXNlLCBj
b3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWIgbGljZW5zZSwKKyAq
IGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29u
cyB0byB3aG9tIHRoZQorICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0
IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisgKiBUaGUgYWJvdmUgY29weXJpZ2h0
IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVkaW5nIHRoZQorICogbmV4
dCBwYXJhZ3JhcGgpIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRp
YWwgcG9ydGlvbnMKKyAqIG9mIHRoZSBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMg
UFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBP
UgorICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElF
UyBPRiBNRVJDSEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9T
RSBBTkQgTk9OLUlORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBBVVRIT1JT
IE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9S
IE9USEVSCisgKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBU
T1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORworICogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJ
T04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUgorICogREVBTElOR1MgSU4g
VEhFIFNPRlRXQVJFLgorICoKKyAqIEF1dGhvcnM6CisgKiAgICBDaHJpc3RpYW4gR21laW5lciA8
Y2hyaXN0aWFuLmdtZWluZXJAZ21haWwuY29tPgorICovCisKKyNpbmNsdWRlICJjb21waWxlci9u
aXIvbmlyLmgiCisjaW5jbHVkZSAiZWlyX2NvbXBpbGVyLmgiCisjaW5jbHVkZSAiZWlyX25pci5o
IgorI2luY2x1ZGUgImVpcl9zaGFkZXIuaCIKKyNpbmNsdWRlICJnYy9nY19kaXNhc20uaCIKKwor
I2luY2x1ZGUgInV0aWwvdV9tZW1vcnkuaCIKKyNpbmNsdWRlICJ1dGlsL3JhbGxvYy5oIgorCitz
dGF0aWMgaW5saW5lIGJvb2wKK2Vpcl9zaGFkZXJfa2V5X2VxdWFsKHN0cnVjdCBlaXJfc2hhZGVy
X2tleSAqYSwgc3RydWN0IGVpcl9zaGFkZXJfa2V5ICpiKQoreworICAgU1RBVElDX0FTU0VSVChz
aXplb2Yoc3RydWN0IGVpcl9zaGFkZXJfa2V5KSA8PSBzaXplb2YoYS0+Z2xvYmFsKSk7CisKKyAg
IHJldHVybiBhLT5nbG9iYWwgPT0gYi0+Z2xvYmFsOworfQorCitzdGF0aWMgdm9pZAorZGVsZXRl
X3ZhcmlhbnQoc3RydWN0IGVpcl9zaGFkZXJfdmFyaWFudCAqdikKK3sKKyAgIGlmICh2LT5pcikK
KyAgICAgIGVpcl9kZXN0cm95KHYtPmlyKTsKKworICAgaWYgKHYtPmNvZGUpCisgICAgICBmcmVl
KHYtPmNvZGUpOworCisgICBGUkVFKHYpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQKK2Fzc2Vt
YmxlX3ZhcmlhbnQoc3RydWN0IGVpcl9zaGFkZXJfdmFyaWFudCAqdikKK3sKKyAgIHYtPmNvZGUg
PSBlaXJfYXNzZW1ibGUodi0+aXIsICZ2LT5pbmZvKTsKKworCS8qIG5vIG5lZWQgdG8ga2VlcCB0
aGUgaXIgYXJvdW5kIGJleW9uZCB0aGlzIHBvaW50ICovCisJZWlyX2Rlc3Ryb3kodi0+aXIpOwor
CXYtPmlyID0gTlVMTDsKK30KKworc3RhdGljIHN0cnVjdCBlaXJfc2hhZGVyX3ZhcmlhbnQgKgor
Y3JlYXRlX3ZhcmlhbnQoc3RydWN0IGVpcl9zaGFkZXIgKnNoYWRlciwgc3RydWN0IGVpcl9zaGFk
ZXJfa2V5IGtleSkKK3sKKyAgIHN0cnVjdCBlaXJfc2hhZGVyX3ZhcmlhbnQgKnYgPSBDQUxMT0Nf
U1RSVUNUKGVpcl9zaGFkZXJfdmFyaWFudCk7CisgICBpbnQgcmV0OworCisgICBuaXJfcHJpbnRf
c2hhZGVyKHNoYWRlci0+bmlyLCBzdGRvdXQpOworCisgICBpZiAoIXYpCisgICAgICByZXR1cm4g
TlVMTDsKKworICAgdi0+aWQgPSBzaGFkZXItPnZhcmlhbnRfY291bnQrKzsKKyAgIHYtPnNoYWRl
ciA9IHNoYWRlcjsKKyAgIHYtPmtleSA9IGtleTsKKworICAgcmV0ID0gZWlyX2NvbXBpbGVfc2hh
ZGVyX25pcihzaGFkZXItPmNvbXBpbGVyLCB2KTsKKyAgIGlmIChyZXQpIHsKKyAgICAgIGRlYnVn
X2Vycm9yKCJjb21waWxlIGZhaWxlZCEiKTsKKyAgICAgIGdvdG8gZmFpbDsKKyAgIH0KKworICAg
YXNzZW1ibGVfdmFyaWFudCh2KTsKKyAgIGlmICghdi0+Y29kZSkgeworICAgICAgZGVidWdfZXJy
b3IoImFzc2VtYmxlIGZhaWxlZCEiKTsKKyAgICAgIGdvdG8gZmFpbDsKKyAgIH0KKworICAgcmV0
dXJuIHY7CisKK2ZhaWw6CisgICBkZWxldGVfdmFyaWFudCh2KTsKKyAgIHJldHVybiBOVUxMOwor
fQorCisvKioKKyAqIFJldHVybnMgdGhlIG1pbmltdW0gbnVtYmVyIG9mIHZlYzQgZWxlbWVudHMg
bmVlZGVkIHRvIHBhY2sgYSB0eXBlLgorICoKKyAqIEZvciBzaW1wbGUgdHlwZXMsIGl0IHdpbGwg
cmV0dXJuIDEgKGEgc2luZ2xlIHZlYzQpOyBmb3IgbWF0cmljZXMsIHRoZQorICogbnVtYmVyIG9m
IGNvbHVtbnM7IGZvciBhcnJheSBhbmQgc3RydWN0LCB0aGUgc3VtIG9mIHRoZSB2ZWM0X3NpemUg
b2YKKyAqIGVhY2ggb2YgaXRzIGVsZW1lbnRzOyBhbmQgZm9yIHNhbXBsZXIgYW5kIGF0b21pYywg
emVyby4KKyAqCisgKiBUaGlzIG1ldGhvZCBpcyB1c2VmdWwgdG8gY2FsY3VsYXRlIGhvdyBtdWNo
IHJlZ2lzdGVyIHNwYWNlIGlzIG5lZWRlZCB0bworICogc3RvcmUgYSBwYXJ0aWN1bGFyIHR5cGUu
CisgKi8KK3N0YXRpYyBpbnQKK2Vpcl90eXBlX3NpemVfdmVjNChjb25zdCBzdHJ1Y3QgZ2xzbF90
eXBlICp0eXBlLCBib29sIGJpbmRsZXNzKQoreworICAgc3dpdGNoIChnbHNsX2dldF9iYXNlX3R5
cGUodHlwZSkpIHsKKyAgIGNhc2UgR0xTTF9UWVBFX1VJTlQ6CisgICBjYXNlIEdMU0xfVFlQRV9J
TlQ6CisgICBjYXNlIEdMU0xfVFlQRV9GTE9BVDoKKyAgIGNhc2UgR0xTTF9UWVBFX0ZMT0FUMTY6
CisgICBjYXNlIEdMU0xfVFlQRV9CT09MOgorICAgY2FzZSBHTFNMX1RZUEVfRE9VQkxFOgorICAg
Y2FzZSBHTFNMX1RZUEVfVUlOVDE2OgorICAgY2FzZSBHTFNMX1RZUEVfSU5UMTY6CisgICBjYXNl
IEdMU0xfVFlQRV9VSU5UODoKKyAgIGNhc2UgR0xTTF9UWVBFX0lOVDg6CisgICBjYXNlIEdMU0xf
VFlQRV9VSU5UNjQ6CisgICBjYXNlIEdMU0xfVFlQRV9JTlQ2NDoKKyAgICAgIGlmIChnbHNsX3R5
cGVfaXNfbWF0cml4KHR5cGUpKSB7CisgICAgICAgICBjb25zdCBzdHJ1Y3QgZ2xzbF90eXBlICpj
b2xfdHlwZSA9IGdsc2xfZ2V0X2NvbHVtbl90eXBlKHR5cGUpOworICAgICAgICAgdW5zaWduZWQg
Y29sX3Nsb3RzID0gZ2xzbF90eXBlX2lzX2R1YWxfc2xvdChjb2xfdHlwZSkgPyAyIDogMTsKKyAg
ICAgICAgIHJldHVybiBnbHNsX2dldF9tYXRyaXhfY29sdW1ucyh0eXBlKSAqIGNvbF9zbG90czsK
KyAgICAgIH0gZWxzZSB7CisgICAgICAgICAvKiBSZWdhcmRsZXNzIG9mIHNpemUgb2YgdmVjdG9y
LCBpdCBnZXRzIGEgdmVjNC4gVGhpcyBpcyBiYWQKKyAgICAgICAgICAqIHBhY2tpbmcgZm9yIHRo
aW5ncyBsaWtlIGZsb2F0cywgYnV0IG90aGVyd2lzZSBhcnJheXMgYmVjb21lIGEKKyAgICAgICAg
ICAqIG1lc3MuIEhvcGVmdWxseSBhIGxhdGVyIHBhc3Mgb3ZlciB0aGUgY29kZSBjYW4gcGFjayBz
Y2FsYXJzCisgICAgICAgICAgKiBkb3duIGlmIGFwcHJvcHJpYXRlLgorICAgICAgICAgICovCisg
ICAgICAgICByZXR1cm4gZ2xzbF90eXBlX2lzX2R1YWxfc2xvdCh0eXBlKSA/IDIgOiAxOworICAg
ICAgfQorICAgY2FzZSBHTFNMX1RZUEVfQVJSQVk6CisgICAgICBhc3NlcnQoZ2xzbF9nZXRfbGVu
Z3RoKHR5cGUpID4gMCk7CisgICAgICByZXR1cm4gZWlyX3R5cGVfc2l6ZV92ZWM0KGdsc2xfZ2V0
X2FycmF5X2VsZW1lbnQodHlwZSksIGJpbmRsZXNzKSAqIGdsc2xfZ2V0X2xlbmd0aCh0eXBlKTsK
KyAgIGNhc2UgR0xTTF9UWVBFX1NUUlVDVDoKKyAgIGNhc2UgR0xTTF9UWVBFX1NVQlJPVVRJTkU6
CisgICBjYXNlIEdMU0xfVFlQRV9TQU1QTEVSOgorICAgY2FzZSBHTFNMX1RZUEVfQVRPTUlDX1VJ
TlQ6CisgICBjYXNlIEdMU0xfVFlQRV9JTUFHRToKKyAgIGNhc2UgR0xTTF9UWVBFX1ZPSUQ6Cisg
ICBjYXNlIEdMU0xfVFlQRV9FUlJPUjoKKyAgIGNhc2UgR0xTTF9UWVBFX0lOVEVSRkFDRToKKyAg
IGNhc2UgR0xTTF9UWVBFX0ZVTkNUSU9OOgorICAgZGVmYXVsdDoKKyAgICAgIHVucmVhY2hhYmxl
KCJ0b2RvIik7CisgICB9CisKKyAgIHJldHVybiAwOworfQorCitzdHJ1Y3QgZWlyX3NoYWRlciAq
CitlaXJfc2hhZGVyX2Zyb21fbmlyKHN0cnVjdCBlaXJfY29tcGlsZXIgKmNvbXBpbGVyLCBzdHJ1
Y3QgbmlyX3NoYWRlciAqbmlyKQoreworICAgc3RydWN0IGVpcl9zaGFkZXIgKnNoYWRlciA9IENB
TExPQ19TVFJVQ1QoZWlyX3NoYWRlcik7CisKKyAgIGFzc2VydChjb21waWxlcik7CisKKyAgIHNo
YWRlci0+bWVtX2N0eCA9IHJhbGxvY19jb250ZXh0KE5VTEwpOworICAgc2hhZGVyLT5jb21waWxl
ciA9IGNvbXBpbGVyOworICAgc2hhZGVyLT5pZCA9IHNoYWRlci0+Y29tcGlsZXItPnNoYWRlcl9j
b3VudCsrOworICAgc2hhZGVyLT50eXBlID0gbmlyLT5pbmZvLnN0YWdlOworCisgICBOSVJfUEFT
U19WKG5pciwgbmlyX2xvd2VyX2lvLCBuaXJfdmFyX2FsbCwgZWlyX3R5cGVfc2l6ZV92ZWM0LAor
ICAgICAgICAgKG5pcl9sb3dlcl9pb19vcHRpb25zKTApOworCisgICBzaGFkZXItPm5pciA9IGVp
cl9vcHRpbWl6ZV9uaXIobmlyKTsKKworICAgcmV0dXJuIHNoYWRlcjsKK30KKwordm9pZAorZWly
X3NoYWRlcl9kZXN0cm95KHN0cnVjdCBlaXJfc2hhZGVyICpzaGFkZXIpCit7CisgICBzdHJ1Y3Qg
ZWlyX3NoYWRlcl92YXJpYW50ICp2LCAqdDsKKworICAgYXNzZXJ0KHNoYWRlcik7CisKKyAgIHYg
PSBzaGFkZXItPnZhcmlhbnRzOworICAgd2hpbGUgKHYpIHsKKyAgICAgIHQgPSB2OworICAgICAg
diA9IHYtPm5leHQ7CisgICAgICBkZWxldGVfdmFyaWFudCh0KTsKKyAgIH0KKworICAgcmFsbG9j
X2ZyZWUoc2hhZGVyLT5uaXIpOworICAgcmFsbG9jX2ZyZWUoc2hhZGVyLT5tZW1fY3R4KTsKKyAg
IEZSRUUoc2hhZGVyKTsKK30KKworc3RydWN0IGVpcl9zaGFkZXJfdmFyaWFudCAqCitlaXJfc2hh
ZGVyX2dldF92YXJpYW50KHN0cnVjdCBlaXJfc2hhZGVyICpzaGFkZXIsIHN0cnVjdCBlaXJfc2hh
ZGVyX2tleSBrZXksIGJvb2wgKmNyZWF0ZWQpCit7CisgICBzdHJ1Y3QgZWlyX3NoYWRlcl92YXJp
YW50ICp2OworCisgICAqY3JlYXRlZCA9IGZhbHNlOworCisgICBmb3IgKHYgPSBzaGFkZXItPnZh
cmlhbnRzOyB2OyB2ID0gdi0+bmV4dCkKKyAgICAgIGlmIChlaXJfc2hhZGVyX2tleV9lcXVhbCgm
a2V5LCAmdi0+a2V5KSkKKyAgICAgICAgIHJldHVybiB2OworCisgICAvKiBjb21waWxlIG5ldyB2
YXJpYW50IGlmIGl0IGRvZXNuJ3QgZXhpc3QgYWxyZWFkeSAqLworICAgdiA9IGNyZWF0ZV92YXJp
YW50KHNoYWRlciwga2V5KTsKKyAgIGlmICh2KSB7CisgICAgICB2LT5uZXh0ID0gc2hhZGVyLT52
YXJpYW50czsKKyAgICAgIHNoYWRlci0+dmFyaWFudHMgPSB2OworICAgICAgKmNyZWF0ZWQgPSB0
cnVlOworICAgfQorCisgICByZXR1cm4gdjsKK30KKworc3RhdGljIGNvbnN0IGNoYXIgKgorc3dp
enpsZV9uYW1lc1s0XSA9Cit7CisgICAieCIsCisgICAieSIsCisgICAieiIsCisgICAidyIKK307
CisKK3ZvaWQKK2Vpcl9kdW1wX3NoYWRlcihzdHJ1Y3QgZWlyX3NoYWRlcl92YXJpYW50ICp2KQor
eworICAgYXNzZXJ0KHYpOworICAgYXNzZXJ0KHYtPnNoYWRlcik7CisgICBhc3NlcnQoKHYtPmlu
Zm8uc2l6ZWR3b3JkcyAlIDIpID09IDApOworICAgdW5zaWduZWQgaTsKKworICAgcHJpbnRmKCIl
c1xuIiwgX21lc2Ffc2hhZGVyX3N0YWdlX3RvX3N0cmluZyh2LT5zaGFkZXItPnR5cGUpKTsKKwor
ICAgc3RydWN0IGdjX3N0cmluZyBkZWNvZGVkID0geworICAgICAgLnN0cmluZyA9IChjaGFyICop
cnphbGxvY19zaXplKE5VTEwsIDEpLAorICAgICAgLm9mZnNldCA9IDAsCisgICB9OworCisgICBm
b3IgKGkgPSAwOyBpIDwgdi0+aW5mby5zaXplZHdvcmRzOyBpICs9IDQpIHsKKyAgICAgIGNvbnN0
IHVpbnQzMl90ICpyYXcgPSAmdi0+Y29kZVtpXTsKKyAgICAgIGdjX2Rpc2FzbSgmZGVjb2RlZCwg
cmF3KTsKKworICAgICAgcHJpbnRmKCIlMDRkOiAlMDh4ICUwOHggJTA4eCAlMDh4ICAlc1xuIiwK
KyAgICAgICAgICAgIGkgLyA0LAorICAgICAgICAgICAgcmF3WzBdLCByYXdbMV0sIHJhd1syXSwg
cmF3WzNdLAorICAgICAgICAgICAgZGVjb2RlZC5zdHJpbmcpOworICAgfQorCisgICByYWxsb2Nf
ZnJlZShkZWNvZGVkLnN0cmluZyk7CisKKyAgIHByaW50ZigibnVtIGxvb3BzOiAwXG4iKTsKKyAg
IHByaW50ZigibnVtIHRlbXBzOiAlaVxuIiwgdi0+bnVtX3RlbXBzKTsKKyAgIHByaW50ZigibnVt
IGNvbnN0OiAlaVxuIiwgdi0+Y29uc3Rfc2l6ZSk7CisKKyAgIHByaW50ZigiaW1tZWRpYXRlczpc
biIpOworICAgaSA9IDA7CisgICB1dGlsX2R5bmFycmF5X2ZvcmVhY2goJnYtPnVuaWZvcm1zLCBz
dHJ1Y3QgZWlyX3VuaWZvcm1fZGF0YSwgdW5pZm9ybSkgeworICAgICAgcHJpbnRmKCIgdSVpLiVz
ID0gMHglMDh4IFslc11cbiIsCisgICAgICAgICAgICAgKHYtPmNvbnN0X3NpemUgKyBpKSAvIDQs
CisgICAgICAgICAgICAgc3dpenpsZV9uYW1lc1tpICUgNF0sCisgICAgICAgICAgICAgdW5pZm9y
bS0+ZGF0YSwKKyAgICAgICAgICAgICBlaXJfdW5pZm9ybV9jb250ZW50KHVuaWZvcm0tPmNvbnRl
bnQpKTsKKworICAgICAgaSsrOworICAgfQorCisgICBzd2l0Y2ggKHYtPnNoYWRlci0+dHlwZSkg
eworICAgY2FzZSBNRVNBX1NIQURFUl9WRVJURVg6CisgICAgICBwcmludGYoImlucHV0czpcbiIp
OworICAgICAgZm9yICh1bnNpZ25lZCBpID0gMDsgaSA8IHYtPm51bV9pbnB1dHM7IGkrKykKKyAg
ICAgICAgIHByaW50ZigiIFslaV0gJXMgY29tcHM6ICV1IGludGVycDogJXNcbiIsCisgICAgICAg
ICAgICAgICBpLCBnbF92YXJ5aW5nX3Nsb3RfbmFtZSh2LT5pbnB1dHNbaV0uc2xvdCksIHYtPmlu
cHV0c1tpXS5uY29tcCwKKyAgICAgICAgICAgICAgIGdsc2xfaW50ZXJwX21vZGVfbmFtZSh2LT5p
bnB1dHNbaV0uaW50ZXJwb2xhdGUpKTsKKworICAgICAgcHJpbnRmKCJvdXRwdXRzOlxuIik7Cisg
ICAgICBmb3IgKHVuc2lnbmVkIGkgPSAwOyBpIDwgdi0+bnVtX291dHB1dHM7IGkrKykKKyAgICAg
ICAgIHByaW50ZigiIFslaV0gJXMgY29tcHM6ICV1XG4iLAorICAgICAgICAgICAgICAgaSwgZ2xf
dmFyeWluZ19zbG90X25hbWUodi0+b3V0cHV0c1tpXS5zbG90KSwgdi0+b3V0cHV0c1tpXS5uY29t
cCk7CisKKyAgICAgIGJyZWFrOworICAgY2FzZSBNRVNBX1NIQURFUl9GUkFHTUVOVDoKKyAgICAg
IHByaW50ZigiaW5wdXRzOlxuIik7CisgICAgICBmb3IgKHVuc2lnbmVkIGkgPSAwOyBpIDwgdi0+
bnVtX2lucHV0czsgaSsrKQorICAgICAgICAgcHJpbnRmKCIgWyVpXSAlcyBjb21wczogJXUgaW50
ZXJwOiAlc1xuIiwKKyAgICAgICAgICAgICAgIGksIGdsX3Zhcnlpbmdfc2xvdF9uYW1lKHYtPmlu
cHV0c1tpXS5zbG90KSwgdi0+aW5wdXRzW2ldLm5jb21wLAorICAgICAgICAgICAgICAgZ2xzbF9p
bnRlcnBfbW9kZV9uYW1lKHYtPmlucHV0c1tpXS5pbnRlcnBvbGF0ZSkpOworCisgICAgICBwcmlu
dGYoIm91dHB1dHM6XG4iKTsKKyAgICAgIGZvciAodW5zaWduZWQgaSA9IDA7IGkgPCB2LT5udW1f
b3V0cHV0czsgaSsrKQorICAgICAgICAgcHJpbnRmKCIgWyVpXSAlcyBjb21wczogJXVcbiIsCisg
ICAgICAgICAgICAgICBpLCBnbF9mcmFnX3Jlc3VsdF9uYW1lKHYtPm91dHB1dHNbaV0uc2xvdCks
IHYtPm91dHB1dHNbaV0ubmNvbXApOworCisgICAgICBicmVhazsKKworICAgZGVmYXVsdDoKKyAg
ICAgIC8qIFRPRE8gKi8KKyAgICAgIGJyZWFrOworICAgfQorCisgICBwcmludGYoInNwZWNpYWw6
XG4iKTsKKyAgIGlmICh2LT5zaGFkZXItPnR5cGUgPT0gTUVTQV9TSEFERVJfVkVSVEVYKSB7Cisg
ICAgICBwcmludGYoIiAgdnNfcG9zX291dF9yZWc9JWlcbiIsIHYtPnZzX3Bvc19vdXRfcmVnKTsK
KyAgICAgIHByaW50ZigiICB2c19wb2ludHNpemVfb3V0X3JlZz0laVxuIiwgdi0+dnNfcG9pbnRz
aXplX291dF9yZWcpOworICAgfSBlbHNlIHsKKyAgICAgIHByaW50ZigiICBwc19jb2xvcl9vdXRf
cmVnPSVpXG4iLCB2LT5mc19jb2xvcl9vdXRfcmVnKTsKKyAgICAgIHByaW50ZigiICBwc19kZXB0
aF9vdXRfcmVnPSVpXG4iLCB2LT5mc19kZXB0aF9vdXRfcmVnKTsKKyAgIH0KK30KZGlmZiAtLWdp
dCBhL3NyYy9ldG5hdml2L2NvbXBpbGVyL2Vpcl9zaGFkZXIuaCBiL3NyYy9ldG5hdml2L2NvbXBp
bGVyL2Vpcl9zaGFkZXIuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMC4u
NjBjNDQ2ZjI5NDMKLS0tIC9kZXYvbnVsbAorKysgYi9zcmMvZXRuYXZpdi9jb21waWxlci9laXJf
c2hhZGVyLmgKQEAgLTAsMCArMSwyMDMgQEAKKy8qCisgKiBDb3B5cmlnaHQgKGMpIDIwMTggRXRu
YXZpdiBQcm9qZWN0CisgKiBDb3B5cmlnaHQgKEMpIDIwMTggWm9kaWFjIEluZmxpZ2h0IElubm92
YXRpb25zCisgKgorICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFy
Z2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKKyAqIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBh
bmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksCisgKiB0
byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0
aG91dCBsaW1pdGF0aW9uCisgKiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJn
ZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3ViIGxpY2Vuc2UsCisgKiBhbmQvb3Igc2VsbCBjb3Bp
ZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAq
IFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5n
IGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMg
cGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUKKyAqIG5leHQgcGFyYWdyYXBoKSBzaGFs
bCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zCisgKiBv
ZiB0aGUgU29mdHdhcmUuCisgKgorICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIs
IFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKKyAqIElNUExJRUQsIElO
Q0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklM
SVRZLAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTi1JTkZSSU5H
RU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMCisgKiBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9M
REVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgorICogTElBQklM
SVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0Us
IEFSSVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRX
QVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIKKyAqIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKyAq
CisgKiBBdXRob3JzOgorICogICAgQ2hyaXN0aWFuIEdtZWluZXIgPGNocmlzdGlhbi5nbWVpbmVy
QGdtYWlsLmNvbT4KKyAqLworCisjaWZuZGVmIEhfRUlSX1NIQURFUgorI2RlZmluZSBIX0VJUl9T
SEFERVIKKworI2luY2x1ZGUgImNvbXBpbGVyL2dsc2xfdHlwZXMuaCIKKyNpbmNsdWRlICJjb21w
aWxlci9zaGFkZXJfZW51bXMuaCIKKyNpbmNsdWRlICJlaXIuaCIKKyNpbmNsdWRlIDxzdGRib29s
Lmg+CisjaW5jbHVkZSA8dXRpbC91X2RlYnVnLmg+CisKK3N0cnVjdCBuaXJfc2hhZGVyOworCitz
dHJ1Y3QgZWlyX3NoYWRlcl9rZXkKK3sKKyAgIHVuaW9uIHsKKyAgICAgIHN0cnVjdCB7CisgICAg
ICAgICAvKgorICAgICAgICAgICogQ29tYmluZWQgVmVydGV4L0ZyYWdtZW50IHNoYWRlciBwYXJh
bWV0ZXJzOgorICAgICAgICAgICovCisKKyAgICAgICAgIC8qIGRvIHdlIG5lZWQgdG8gc3dhcCBy
YiBpbiBmcmFnIGNvbG9yPyAqLworICAgICAgICAgdW5zaWduZWQgZnJhZ19yYl9zd2FwIDogMTsK
KyAgICAgIH07CisgICAgICB1aW50MzJfdCBnbG9iYWw7CisgICB9OworfTsKKworc3RydWN0IGVp
cl9zaGFkZXI7CisKK3N0cnVjdCBlaXJfc2hhZGVyX3ZhcmlhbnQKK3sKKyAgIC8qIHZhcmlhbnQg
aWQgKGZvciBkZWJ1ZykgKi8KKyAgIHVpbnQzMl90IGlkOworCisgICBzdHJ1Y3QgZWlyX3NoYWRl
ciAqc2hhZGVyOworICAgc3RydWN0IGVpcl9zaGFkZXJfa2V5IGtleTsKKyAgIHN0cnVjdCBlaXJf
aW5mbyBpbmZvOworICAgc3RydWN0IGVpciAqaXI7CisKKyAgIHVpbnQzMl90ICpjb2RlOworCisg
ICB1bnNpZ25lZCBudW1fdGVtcHM7CisgICB1bnNpZ25lZCBudW1fbG9vcHM7CisgICB1bnNpZ25l
ZCBjb25zdF9zaXplOworCisgICAvKiBrZWVwIHRyYWNrIG9mIHVuaWZvcm1zICovCisgICBzdHJ1
Y3QgdXRpbF9keW5hcnJheSB1bmlmb3JtczsKKworICAgLyogYXR0cmlidXRlcy92YXJ5aW5nczog
Ki8KKyAgIHVuc2lnbmVkIG51bV9pbnB1dHM7CisgICBzdHJ1Y3QgeworICAgICAgdWludDhfdCBy
ZWc7CisgICAgICB1aW50OF90IHNsb3Q7CisgICAgICB1aW50OF90IG5jb21wOworCisgICAgICBl
bnVtIGdsc2xfaW50ZXJwX21vZGUgaW50ZXJwb2xhdGU7CisgICB9IGlucHV0c1sxNl07CisKKyAg
IC8qIHZhcnlpbmdzL291dHB1dHM6ICovCisgICB1bnNpZ25lZCBudW1fb3V0cHV0czsKKyAgIHN0
cnVjdCB7CisgICAgICB1aW50OF90IHJlZzsKKyAgICAgIHVpbnQ4X3Qgc2xvdDsKKyAgICAgIHVp
bnQ4X3QgbmNvbXA7CisgICB9IG91dHB1dHNbMTZdOworCisgICAvKiBzcGVjaWFsIG91dHB1dHMg
KHZzIG9ubHkpICovCisgICBpbnQgdnNfcG9zX291dF9yZWc7IC8qIFZTIHBvc2l0aW9uIG91dHB1
dCAqLworICAgaW50IHZzX3BvaW50c2l6ZV9vdXRfcmVnOyAvKiBWUyBwb2ludCBzaXplIG91dHB1
dCAqLworCisgICAvKiBzcGVjaWFsIG91dHB1dHMgKGZzIG9ubHkpICovCisgICBpbnQgZnNfY29s
b3Jfb3V0X3JlZzsgLyogY29sb3Igb3V0cHV0IHJlZ2lzdGVyICovCisgICBpbnQgZnNfZGVwdGhf
b3V0X3JlZzsgLyogZGVwdGggb3V0cHV0IHJlZ2lzdGVyICovCisKKyAgIC8qIHNoYWRlciB2YXJp
YW50cyBmb3JtIGEgbGlua2VkIGxpc3QgKi8KKyAgIHN0cnVjdCBlaXJfc2hhZGVyX3ZhcmlhbnQg
Km5leHQ7Cit9OworCitzdHJ1Y3QgZWlyX3NoYWRlcgoreworICAgdm9pZCAqbWVtX2N0eDsKKyAg
IGdsX3NoYWRlcl9zdGFnZSB0eXBlOworCisgICAvKiBzaGFkZXIgaWQgKGZvciBkZWJ1Zyk6ICov
CisgICB1aW50MzJfdCBpZDsKKyAgIHVpbnQzMl90IHZhcmlhbnRfY291bnQ7CisKKyAgIHN0cnVj
dCBlaXJfY29tcGlsZXIgKmNvbXBpbGVyOworICAgc3RydWN0IG5pcl9zaGFkZXIgKm5pcjsKKyAg
IHN0cnVjdCBlaXJfc2hhZGVyX3ZhcmlhbnQgKnZhcmlhbnRzOworfTsKKworc3RydWN0IGVpcl9z
aGFkZXIgKgorZWlyX3NoYWRlcl9mcm9tX25pcihzdHJ1Y3QgZWlyX2NvbXBpbGVyICpjb21waWxl
ciwgc3RydWN0IG5pcl9zaGFkZXIgKm5pcik7CisKK3ZvaWQKK2Vpcl9zaGFkZXJfZGVzdHJveShz
dHJ1Y3QgZWlyX3NoYWRlciAqc2hhZGVyKTsKKworc3RydWN0IGVpcl9zaGFkZXJfdmFyaWFudCAq
CitlaXJfc2hhZGVyX2dldF92YXJpYW50KHN0cnVjdCBlaXJfc2hhZGVyICpzaGFkZXIsIHN0cnVj
dCBlaXJfc2hhZGVyX2tleSBrZXksIGJvb2wgKmNyZWF0ZWQpOworCit2b2lkCitlaXJfZHVtcF9z
aGFkZXIoc3RydWN0IGVpcl9zaGFkZXJfdmFyaWFudCAqdmFyaWFudCk7CisKK3N0cnVjdCBlaXJf
c2hhZGVyX2xpbmthZ2UgeworICAgdWludDhfdCBudW1fdmFyeWluZ3M7CisgICBzdHJ1Y3Qgewor
ICAgICAgdWludDMyX3QgcGFfYXR0cmlidXRlczsKKyAgICAgIHVpbnQ4X3QgbmNvbXA7CisgICAg
ICB1aW50OF90IHVzZVs0XTsKKyAgICAgIHVpbnQ4X3QgcmVnOworICAgfSB2YXJ5aW5nc1sxNl07
Cit9OworCitzdGF0aWMgaW5saW5lIGludAorZWlyX2ZpbmRfb3V0cHV0KGNvbnN0IHN0cnVjdCBl
aXJfc2hhZGVyX3ZhcmlhbnQgKnYsIGdsX3Zhcnlpbmdfc2xvdCBzbG90KQoreworCWZvciAodW5z
aWduZWQgaSA9IDA7IGkgPCB2LT5udW1fb3V0cHV0czsgaSsrKQorCQlpZiAodi0+b3V0cHV0c1tp
XS5zbG90ID09IHNsb3QpCisJCQlyZXR1cm4gaTsKKworICAgZGVidWdfYXNzZXJ0KDApOworCisg
ICByZXR1cm4gMDsKK30KKworLyogVE9ETzogKi8KKyNkZWZpbmUgVkFSWUlOR19DT01QT05FTlRf
VVNFX1VOVVNFRAkJCQkweDAwMDAwMDAwCisjZGVmaW5lIFZBUllJTkdfQ09NUE9ORU5UX1VTRV9V
U0VECQkJCTB4MDAwMDAwMDEKKyNkZWZpbmUgVkFSWUlOR19DT01QT05FTlRfVVNFX1BPSU5UQ09P
UkRfWAkJCTB4MDAwMDAwMDIKKyNkZWZpbmUgVkFSWUlOR19DT01QT05FTlRfVVNFX1BPSU5UQ09P
UkRfWQkJCTB4MDAwMDAwMDMKKworc3RhdGljIGlubGluZSB2b2lkCitlaXJfbGlua19hZGQoc3Ry
dWN0IGVpcl9zaGFkZXJfbGlua2FnZSAqbCwgdWludDhfdCByZWcsIHVpbnQ4X3QgbmNvbXApCit7
CisgICBib29sIGludGVycG9sYXRlX2Fsd2F5cyA9IGZhbHNlOyAvKiBUT0RPOiAqLworICAgdWlu
dDMyX3QgcGFfYXR0cmlidXRlczsKKyAgIGludCBpID0gbC0+bnVtX3ZhcnlpbmdzKys7CisKKyAg
IGRlYnVnX2Fzc2VydChpIDwgQVJSQVlfU0laRShsLT52YXJ5aW5ncykpOworCisgICBpZiAoIWlu
dGVycG9sYXRlX2Fsd2F5cykgLyogY29sb3JzIGFmZmVjdGVkIGJ5IGZsYXQgc2hhZGluZyAqLwor
ICAgICAgcGFfYXR0cmlidXRlcyA9IDB4MjAwOworICAgZWxzZSAvKiB0ZXh0dXJlIGNvb3JkIG9y
IG90aGVyIGJ5cGFzc2VzIGZsYXQgc2hhZGluZyAqLworICAgICAgcGFfYXR0cmlidXRlcyA9IDB4
MmYxOworCisgICBsLT52YXJ5aW5nc1tpXS5yZWcgPSByZWc7CisgICBsLT52YXJ5aW5nc1tpXS5u
Y29tcCA9IG5jb21wOworICAgbC0+dmFyeWluZ3NbaV0ucGFfYXR0cmlidXRlcyA9IHBhX2F0dHJp
YnV0ZXM7CisKKyAgIGwtPnZhcnlpbmdzW2ldLnVzZVswXSA9IGludGVycG9sYXRlX2Fsd2F5cyA/
IFZBUllJTkdfQ09NUE9ORU5UX1VTRV9QT0lOVENPT1JEX1ggOiBWQVJZSU5HX0NPTVBPTkVOVF9V
U0VfVVNFRDsKKyAgIGwtPnZhcnlpbmdzW2ldLnVzZVsxXSA9IGludGVycG9sYXRlX2Fsd2F5cyA/
IFZBUllJTkdfQ09NUE9ORU5UX1VTRV9QT0lOVENPT1JEX1kgOiBWQVJZSU5HX0NPTVBPTkVOVF9V
U0VfVVNFRDsKKyAgIGwtPnZhcnlpbmdzW2ldLnVzZVsyXSA9IFZBUllJTkdfQ09NUE9ORU5UX1VT
RV9VU0VEOworICAgbC0+dmFyeWluZ3NbaV0udXNlWzNdID0gVkFSWUlOR19DT01QT05FTlRfVVNF
X1VTRUQ7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZAorZWlyX2xpbmtfc2hhZGVyKHN0cnVjdCBl
aXJfc2hhZGVyX2xpbmthZ2UgKmwsCisgICBjb25zdCBzdHJ1Y3QgZWlyX3NoYWRlcl92YXJpYW50
ICp2cywKKyAgIGNvbnN0IHN0cnVjdCBlaXJfc2hhZGVyX3ZhcmlhbnQgKmZzKQoreworICAgaW50
IGkgPSAwOworCisgICB3aGlsZSAobC0+bnVtX3ZhcnlpbmdzIDwgQVJSQVlfU0laRShsLT52YXJ5
aW5ncykpIHsKKworCQlpZiAoaSA+PSBmcy0+bnVtX2lucHV0cykKKwkJCWJyZWFrOworCisgICAg
ICBpbnQgcmVnID0gZWlyX2ZpbmRfb3V0cHV0KHZzLCBmcy0+aW5wdXRzW2ldLnNsb3QpOworCisg
ICAgICBlaXJfbGlua19hZGQobCwgcmVnLCBmcy0+aW5wdXRzW2ldLm5jb21wKTsKKworICAgICAg
aSsrOworICAgfQorfQorCisjZW5kaWYgLy8gSF9FSVJfU0hBREVSCmRpZmYgLS1naXQgYS9zcmMv
ZXRuYXZpdi9jb21waWxlci9tZXNvbi5idWlsZCBiL3NyYy9ldG5hdml2L2NvbXBpbGVyL21lc29u
LmJ1aWxkCmluZGV4IDc0N2I5NTM2YmI3Li5mOGFmNmM4YjM1ZCAxMDA2NDQKLS0tIGEvc3JjL2V0
bmF2aXYvY29tcGlsZXIvbWVzb24uYnVpbGQKKysrIGIvc3JjL2V0bmF2aXYvY29tcGlsZXIvbWVz
b24uYnVpbGQKQEAgLTIzLDEzICsyMywxNyBAQAogbGliZXRuYXZpdl9jb21waWxlcl9maWxlcyA9
IGZpbGVzKAogICAnZWlyLmMnLAogICAnZWlyLmgnLAorICAnZWlyX2NvbXBpbGVyLmMnLAogICAn
ZWlyX2NvbXBpbGVyLmgnLAorICAnZWlyX2NvbXBpbGVyX25pci5jJywKICAgJ2Vpcl9sZWdhbGl6
ZS5jJywKICAgJ2Vpcl9saXZlX3ZhcmlhYmxlcy5jJywKICAgJ2Vpcl9uaXIuYycsCiAgICdlaXJf
bmlyLmgnLAogICAnZWlyX3ByaW50LmMnLAogICAnZWlyX3JlZ2lzdGVyX2FsbG9jYXRlLmMnLAor
ICAnZWlyX3NoYWRlci5jJywKKyAgJ2Vpcl9zaGFkZXIuaCcsCiAgICdlaXJfdW5pZm9ybS5jJywK
ICkKIAotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpldG5hdml2IG1haWxpbmcgbGlzdApldG5hdml2QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2V0bmF2aXY=
